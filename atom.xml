<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Good good study, day day up]]></title>
  <link href="http://aleung.github.com/blog/atom.xml" rel="self"/>
  <link href="http://aleung.github.com/blog/"/>
  <updated>2013-03-22T23:49:15+08:00</updated>
  <id>http://aleung.github.com/blog/</id>
  <author>
    <name><![CDATA[Leo Liang]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Clean aged artifacts from Artifactory]]></title>
    <link href="http://aleung.github.com/blog/2013/03/22/clean-aged-artifacts-from-artifactory/"/>
    <updated>2013-03-22T23:21:00+08:00</updated>
    <id>http://aleung.github.com/blog/2013/03/22/clean-aged-artifacts-from-artifactory</id>
    <content type="html"><![CDATA[<p><a href="http://www.jfrog.com/home/v_artifactory_opensource_overview">Artifactory</a> has no feature to automatically remove old artifacts from local repository. Once the disk is full, manually remove unused artifacts is painful. Moveover, you’re not sure which artifacts are unused and can be safely deleted.</p>

<p>Artifactory has a set of <a href="http://wiki.jfrog.org/confluence/display/RTF/Artifactory's+REST+API">REST API</a>. One of the API is to search artifacts not downloaded since a specified date. In our projects, there are CI jobs which keep building the software for each branch. If a SNAPSHOT artifact hasn’t been downloaded for a time, we can make sure that this artifact is no use any more, a newer version should be existing.</p>

<p>I made a Ruby script to do the clean up job automatically. It searches artifacts which weren’t downloaded in specific days and deletes them. It can be invoked in a CI job to run periodically. </p>

<div><script src="https://gist.github.com/5203736.js?file="></script>
<noscript><pre><code /></pre></noscript></div>

<p>The script can also be used to clean unused release (non-SNAPSHOT) artifacts. However a good practice is to keep releases forever. </p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Batch deploy artifacts to Maven repository]]></title>
    <link href="http://aleung.github.com/blog/2013/03/19/maven-batch-deploy-artifacts/"/>
    <updated>2013-03-19T21:32:00+08:00</updated>
    <id>http://aleung.github.com/blog/2013/03/19/maven-batch-deploy-artifacts</id>
    <content type="html"><![CDATA[<p>I need to migrate a Maven repository from <a href="http://www.jfrog.com/home/v_artifactory_opensource_overview">Artifactory</a> to <a href="http://www.sonatype.org/nexus/">Nexus</a>. Nexus’s migration <a href="http://www.sonatype.com/people/2009/03/migrating-from-artifactory-to-nexus/">solution</a> uses its migration plugin. But our Nexus service is managed by IT team and I don’t want to bother to ask them to install a plugin.</p>

<p>Artifactory is able to export a whole repository into file system as local repository layout (like .m2/repository folder). So I looked for import feature in Nexus, but failed.</p>

<p>Searched on Google then I found <a href="http://stackoverflow.com/a/3304212/94148">this answer</a> on StackOverflow. Sean provided a pom with embedded Groovy script to upload (deploy) a hierarchy of files to a Maven repository. However Sean’s solution handles groupId, artifactId and version in a way differ to what I want. It requires to specify groupId and version in pom as fixed value.</p>

<p>I modify the Groovy script a bit to handle local repository folder layout. GroupId, artifactId and version are parsed from path of file. Here is my modified version:</p>

<div><script src="https://gist.github.com/5194777.js?file="></script>
<noscript><pre><code /></pre></noscript></div>

<p>Before using it, modify the setting in &lt;deploy.basefolder&gt; and &lt;distributionManagement&gt;. Make sure you have removed all non-artifact files e.g. *.sha1, *.lastUpdated from your import directory. Or you may enhance the script to filter those files out.</p>

<p>Suppose your import folder is ~/.m2/repository, put this pom.xml at ~/.m2. Run <code>cd ~/.m2; mvn install</code> then everything is done.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[站立工作环境]]></title>
    <link href="http://aleung.github.com/blog/2013/03/18/stand-up-desk/"/>
    <updated>2013-03-18T23:44:00+08:00</updated>
    <id>http://aleung.github.com/blog/2013/03/18/stand-up-desk</id>
    <content type="html"><![CDATA[<p>坐姿，特别是不正确的坐姿，对腰椎间盘的压力是站姿的2到3倍，长期在电脑前工作的人很容易得腰椎间盘突出等腰椎疾病。因此现在IT工作者逐渐流行站立工作。但是，长期站立也会带来其他的问题，如下肢静脉曲张等。一个比较理想的方案是使用可升降的办公桌，坐姿站姿交替。</p>

<p>2011年我花了不少时间寻找国内哪里可以买到可升降办公桌，但都没有找到。网上搜索倒是有不少信息，但都是厂家寻求批发订货的，电话问过几个本地厂商，基本都说不做，做的也没有现货不零售。唯一的是淘宝上有个泠泠岛，做个人客户，当时价格很高，外地购买也不方便，而且我对它的质量不是很放心。最终放弃了购买升降桌的念头，改为自行DIY站立工作桌。</p>

<p>2012年初用IKEA的BRODER系统加一个VIKA桌面搭建了一个站立工作桌。BRODER归属在重型储物系列里，本来用途是储物架，钢柱杆和钢网搁板很牢固，最大的搁板深度基本足够做桌面了，在上面垫上一块木桌面刚刚好。用IKEA的东西好处是你有很大发挥的空间，这个<a href="http://www.wretch.cc/blog/ikeameatball/12392137">IKEA的居家生活部落格</a>里就有不少BRODER各种应用的照片。但刚刚查IKEA中国网站，已经找不到BRODER，不知是否不卖了。</p>

<p><img src="http://aleung.github.com/blog/attachments/2013/3/desk.jpg" /></p>

<p>就这样用了一年，但长期站立工作也不好，于是想配一张高脚凳也许就差不多了。桌面高度是按站立工作而定的，按照我的身高桌面高度也偏高，一般市面上卖的高脚凳（酒吧凳）座高都不够。最后在淘宝上找到了一款，高度比较合适。今天到货刚刚装起来了。其实这凳子做工、质量都不算很好，组装也不够方便，如果IKEA有合适的我绝对不会选择它的（虽然说IKEA的东西质量也只算一般，但还是要比这淘宝货强）。</p>

<p><img src="http://aleung.github.com/blog/attachments/2013/3/desk_chair.jpg" /></p>

<p>关于工作台面、座椅以及显示器的合适高度，在<a href="http://book.douban.com/subject/11652185/">Human Factors in Engineering and Design</a>一书的 chapter 13. Applied Anthropometry, Work-Space Design and Seating 中对站姿与坐姿工作环境有很好的描述。我在决定台面高度与椅子高度的时候参考了此书中给出的研究数据。</p>

<p>顺便说说，上面提到那本书是<a href="http://zh.wikipedia.org/wiki/%E4%BA%BA%E5%9B%A0%E5%B7%A5%E7%A8%8B%E5%AD%A6">人因学</a>的经典好书，国内有<a href="http://book.douban.com/subject/3746065/">中文翻译版</a>。</p>

<p>另外再推荐阅读：美国职业健康和安全管理局(OSHA)工作区健康与安全指南<a href="http://www.youliv.com/ErgoStandard/WSGoodPositions.aspx">中文翻译</a>。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[怎么处理Android耗电严重的问题]]></title>
    <link href="http://aleung.github.com/blog/2013/03/10/which-app-is-draining-your-android-bettery/"/>
    <updated>2013-03-10T21:49:00+08:00</updated>
    <id>http://aleung.github.com/blog/2013/03/10/which-app-is-draining-your-android-bettery</id>
    <content type="html"><![CDATA[<p>Android用户常常会被耗电问题困扰，明明手机没怎么使用，电量却不停的掉，半天就耗光了。有些人会寻求kill应用的方法——而Android系统的设计原则是用户不需要关心进程的启停的。其实大多数情况下，这都跟系统无关，而是安装的某些应用的问题。合理设计的应用，即使有后台进程，也只会在必要的时候唤醒进行短时间工作。但有些应用开发者不懂怎么合理设计应用后台任务，造成耗电问题。</p>

<p>要解决耗电问题，首先得找出是那个应用耗电。Android 4.0以上系统已经能够显示出系统各模块以及各个应用的耗电比例（设置－电量使用情况），不过细节信息还是不够多，往往不足以判定是什么原因耗电严重，这时候就要用到这个应用：<a href="https://play.google.com/store/apps/details?id=com.gsamlabs.bbm">GSam Battery Monitor</a>。就像Android系统的电量使用情况，GSam可以列出系统各模块（系统、电话、屏幕、Wifi等）以及各应用的耗电比例，但它可以看到每项更细节的信息，如某一应用使用各传感器的时间、屏幕不同亮度分布使用时间等等，可以帮助判断是什么模块／应用耗电严重，以及耗电的具体原因。GSam还有更多的功能，用起来也不太复杂，自己摸索一下就行。</p>

<p>找到罪魁祸首后，最简单处理手段就是卸载它。但如果这个应用非装不可没有替代品，怎么办？Kill不是办法，若应用因后台服务而耗电，后台服务kill掉也能自动重启的。每次用完都要去kill用起来也不方便。这时 <a href="https://play.google.com/store/apps/details?id=com.oasisfeng.greenify">Greenify</a> 就派上用场了，当你将一个应用加入greenify列表中，它能够在你不使用这个应用时将它进入冬眠状态，但又不影响其正常使用。除了用来对付耗电应用，对付耗内存应用也不错，当应用冬眠时，也不会占用内存(RAM)。至于它的工作原理，作者没有透露过，我还没有见到有解释。Greenify只能用于Android 3.1+，需要root。Android手机要玩好，root基本上是不可少的。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[R初略学习笔记]]></title>
    <link href="http://aleung.github.com/blog/2013/02/09/beginning-r/"/>
    <updated>2013-02-09T14:18:00+08:00</updated>
    <id>http://aleung.github.com/blog/2013/02/09/beginning-r</id>
    <content type="html"><![CDATA[<h2 id="section">包管理</h2>

<p>从CRAN安装一个包：<code>install.packages("pkg_name")</code></p>

<p>加载包：<code>library(package)</code></p>

<h2 id="r">R的基本数据类型</h2>

<p>在R里面一个元素的基本数据类型称为 mode。每个对象都有mode属性。</p>

<p>基本数据类型包括：数值(实数) numeric，复数 complex，字符(串) character，逻辑(布尔) logical 和 raw。NA表示没有值。</p>

<p>基本数据类型之间的转换通过 as.<em>something</em>() 函数进行，例如 <code>as.character()</code>, <code>as.integer()</code>。</p>

<h2 id="r-1">R的数据对象类型</h2>

<h3 id="vector">向量 vector</h3>

<p>向量由一组相同类型的元素组成。</p>

<p>用函数 c() 可以构造出向量：</p>

<pre><code>x &lt;- c(10.4, 5.6, 3.1, 21.7)
</code></pre>

<p>如果要生成元素为序列的向量，简单的方法是用冒号，如 1:7，复杂的方法是函数 seq()。另外，函数 rep() 可以根据已有向量的元素重复来生成新向量。</p>

<p>向量中的某个元素通过 [] 访问，如 <code>x[3]</code>，注意，下标从1开始！方括号中下标位置放的可以是向量，称为索引向量 index vector，这时候会根据索引取出特定元素构成新的向量。例如 <code>x[1:10]</code> 取出x的前10个元素。</p>

<p>对向量做运算，是对向量的每个元素做独立运算，结果是一个相同元素个数的新向量。</p>

<h3 id="factor">因子 factor</h3>

<p><strong>TODO</strong>：没懂</p>

<h3 id="array">数组 array</h3>

<p>数组是多维的一组相同类型数据。特别地，二维数组称为矩阵 matrix。</p>

<p>通过指定维度属性 dim，向量可以转换为数组。例如z为有1500个元素的向量，<code>dim(z) &lt;- c(3, 5, 100)</code> 将z变作3<em>5</em>100的三维数组。另外一种构造数组的方法是用函数 array()： <code>Z &lt;- array(data_vector, dim_vector)</code>。向量中元素是按照首下标优先的顺序来遍历的，如 <code>z[1,1,1], z[2,1,1], …, z[2,5,100], z[3,5,100]</code>。</p>

<p>可以通过 <code>a[2,,]</code> 这样的方法访问子数组，得到的是指定了第一维为2后剩余维数的数组。正如可以用向量为下标来访问向量，也可以用索引矩阵 index matrix 作为下标来访问数组，这样可以根据索引矩阵的值为下标取出数组中的特定一组元素。</p>

<p>通过 <code>as.vector(X)</code> 或者 <code>c(X)</code> 可以将数组X变回向量。</p>

<h3 id="list">列表 list</h3>

<p>文档里叫list，但实际上更象其他语言里的map，或者叫hash。列表里的每个元素是一个对象，称为组件 componet，列表里的组件的类型不需要一致。</p>

<p>生成列表的方法：<code>Lst &lt;- list(name_1=object_1, …, name_m=object_m)</code>。组件名字是可忽略的。构成列表的对象会复制一个副本到列表里面，而不是引用。</p>

<p>用 <code>[[n]]</code> 来访问列表中的第n个组件。如果组件有名字，用 <code>list$component_name</code> 的方法更简便。组件名可以简写为名字的前几个字母，只要不引起歧义就行。</p>

<h3 id="data-frame">数据帧 data frame</h3>

<p>数据帧是特殊的列表：</p>

<ul>
  <li>组件为向量(数值型,字符形,逻辑型)，因子，数值矩阵，列表或其他数据帧</li>
  <li>数据帧中作为变量的向量结构必须具有相同的长度,而矩阵结构应当具有相同的行大小</li>
</ul>

<p>很多情况下,数据帧会被当作各列具有不同模式和属性的矩阵。</p>

<p>数据帧同样可以用下标来获取子集，例如看前三行数据：<code>data[1:3,]</code>，根据某列的值做过滤：<code>filtered_frame &lt;- full_frame[full_frame$country=="cn",]</code></p>

<p>通过 <code>as.matrix(X)</code> 将数据帧转换为矩阵。</p>

<h2 id="section-1">读取数据</h2>

<p>函数 <code>read.table()</code> 读取文本文件的数据，产生一个数据帧。更常用的是 <code>read.csv()</code> 和 <code>read.delim()</code>，它们是 read.table() 的缺省参数版本，后者读取tab分隔的文件。文件的每个列被保存到数据帧的一个组件中，组件名字就是列的名字，如果列名里有空格会被转换成句点。</p>

<h2 id="section-2">绘图</h2>

<h3 id="section-3">高级绘图函数</h3>

<p>下面是R中高级绘图函数的概括:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">函数</th>
      <th style="text-align: left">说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">plot(x)</td>
      <td style="text-align: left">以x的元素值为纵坐标、以序号为横坐标绘图</td>
    </tr>
    <tr>
      <td style="text-align: left">plot(x, y)</td>
      <td style="text-align: left">x(在x-轴上)与y(在y-轴上)的二元作图。根据type参数可以画出多种类型的图。</td>
    </tr>
    <tr>
      <td style="text-align: left">sunflowerplot(x,y)</td>
      <td style="text-align: left">同上 但是以相似坐标的点作为花朵,其花瓣数目为点的个数</td>
    </tr>
    <tr>
      <td style="text-align: left">pie(x)</td>
      <td style="text-align: left">饼图</td>
    </tr>
    <tr>
      <td style="text-align: left">boxplot(x)</td>
      <td style="text-align: left">盒形图(“box-and-whiskers”)</td>
    </tr>
    <tr>
      <td style="text-align: left">stripchart(x)</td>
      <td style="text-align: left">把x的值画在一条线段上,样本量较小时可作为盒形图的替代</td>
    </tr>
    <tr>
      <td style="text-align: left">coplot(x~y|z)</td>
      <td style="text-align: left">关于z的每个数值(或数值区间)绘制x与y的二元图</td>
    </tr>
    <tr>
      <td style="text-align: left">interaction.plot(f1, f2, y)</td>
      <td style="text-align: left">如果f1和f2是因子,作y的均值图,以f1的不同值作为x轴, 而f2的不同值对应不同曲线;可以用选项fun指定y的其他的统计量(缺省计算均值,fun=mean)</td>
    </tr>
    <tr>
      <td style="text-align: left">matplot(x,y)</td>
      <td style="text-align: left">二元图,其中x的第一列对应y的第一列,x的第二列对应y的第二 列,依次类推。</td>
    </tr>
    <tr>
      <td style="text-align: left">dotchart(x)</td>
      <td style="text-align: left">如果x是数据框,作Cleveland点图(逐行逐列累加图)</td>
    </tr>
    <tr>
      <td style="text-align: left">fourfoldplot(x)</td>
      <td style="text-align: left">用四个四分之一圆显示2X2列联表情况(x必须是dim=c(2, 2, k)的数组,或者是dim=c(2, 2)的矩阵,如果k = 1)</td>
    </tr>
    <tr>
      <td style="text-align: left">assocplot(x)</td>
      <td style="text-align: left">Cohen–Friendly图,显示在二维列联表中行、列变量偏离独立性 的程度</td>
    </tr>
    <tr>
      <td style="text-align: left">mosaicplot(x)</td>
      <td style="text-align: left">列联表的对数线性回归残差的马赛克图</td>
    </tr>
    <tr>
      <td style="text-align: left">pairs(x)</td>
      <td style="text-align: left">如果x是矩阵或是数据框,作x的各列之间的二元图</td>
    </tr>
    <tr>
      <td style="text-align: left">plot.ts(x)</td>
      <td style="text-align: left">如果x是类”ts”的对象,作x的时间序列曲线,x可以是多元的, 但是序列必须有相同的频率和时间</td>
    </tr>
    <tr>
      <td style="text-align: left">ts.plot(x)</td>
      <td style="text-align: left">同上,但如果x是多元的,序列可有不同的时间但须有相同的频 率</td>
    </tr>
    <tr>
      <td style="text-align: left">hist(x)</td>
      <td style="text-align: left">x的频率直方图</td>
    </tr>
    <tr>
      <td style="text-align: left">barplot(x)</td>
      <td style="text-align: left">x的值的条形图</td>
    </tr>
    <tr>
      <td style="text-align: left">qqnorm(x)</td>
      <td style="text-align: left">正态分位数-分位数图</td>
    </tr>
    <tr>
      <td style="text-align: left">qqplot(x, y)</td>
      <td style="text-align: left">y对x的分位数-分位数图</td>
    </tr>
    <tr>
      <td style="text-align: left">contour(x, y, z)</td>
      <td style="text-align: left">等高线图(画曲线时用内插补充空白的值),x和y必须为向量 ,z必须为矩阵 , 使得dim(z)=c(length(x), length(y))(x和y可以省略)</td>
    </tr>
    <tr>
      <td style="text-align: left">filled.contour (x,y, z)</td>
      <td style="text-align: left">同上,等高线之间的区域是彩色的,并且绘制彩色对应的值的图 例</td>
    </tr>
    <tr>
      <td style="text-align: left">image(x, y, z)</td>
      <td style="text-align: left">同上,但是实际数据大小用不同色彩表示</td>
    </tr>
    <tr>
      <td style="text-align: left">persp(x, y, z)</td>
      <td style="text-align: left">同上,但为透视图</td>
    </tr>
    <tr>
      <td style="text-align: left">stars(x)</td>
      <td style="text-align: left">如果x是矩阵或者数据框,用星形和线段画出</td>
    </tr>
    <tr>
      <td style="text-align: left">symbols(x, y, …)</td>
      <td style="text-align: left">在由x和y给定坐标画符号(圆,正方形,长方形,星,温度计式 或者盒形图),符号的类型、大小、颜色等由另外的变量指定</td>
    </tr>
    <tr>
      <td style="text-align: left">termplot(mod.obj)</td>
      <td style="text-align: left">回归模型(mod.obj)的(偏)影响图</td>
    </tr>
    <tr>
      <td style="text-align: left">heatmap(x)</td>
      <td style="text-align: left">热度图</td>
    </tr>
  </tbody>
</table>

<h4 id="section-4">需要工具包支持的高级绘图</h4>

<p><strong>板块层级图 tree map</strong></p>

<p>用矩形面积来表示数值，可用于分析磁盘空间占用</p>

<pre><code>library(portfolio)
map.market(id, area, group, color)
</code></pre>

<p><strong>平行坐标图</strong></p>

<pre><code>library(lattice)
parallel(data)
</code></pre>

<h3 id="section-5">低级绘图命令</h3>

<p>R里面有一套绘图函数是作用于现存的图形上的:称为低级作图命 令(low-level plotting commands)。下面有一些主要的:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">函数</th>
      <th style="text-align: left">说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">scatter.smooth(x, y, …)</td>
      <td style="text-align: left">LOESS(局部加权散点平滑)拟合曲线</td>
    </tr>
    <tr>
      <td style="text-align: left">points(x, y)</td>
      <td style="text-align: left">添加点(可以使用选项type=)</td>
    </tr>
    <tr>
      <td style="text-align: left">lines(x, y)</td>
      <td style="text-align: left">同上,但是添加线</td>
    </tr>
    <tr>
      <td style="text-align: left">text(x, y, labels,…)</td>
      <td style="text-align: left">在(x,y)处添加用labels指定的文字;典型的用法是: plot(x, y, type=”n”); text(x, y, names)</td>
    </tr>
    <tr>
      <td style="text-align: left">mtext(text,side=3, line=0,…)</td>
      <td style="text-align: left">在边空添加用text指定的文字,用side指定添加到哪一边(参照 下面的axis());line指定添加的文字距离绘图区域的行数</td>
    </tr>
    <tr>
      <td style="text-align: left">segments(x0, y0,x1, y1)</td>
      <td style="text-align: left">从(x0,y0)各点到(x1,y1)各点画线段</td>
    </tr>
    <tr>
      <td style="text-align: left">arrows(x0, y0,x1, y1, angle= 30,code=2)</td>
      <td style="text-align: left">同上但加画箭头,如果code=2则在各(x0,y0)处画箭头,如 果code=1则在各(x1,y1)处画箭头,如果code=3则在两端都画箭头; angle控制箭头轴到箭头边的角度</td>
    </tr>
    <tr>
      <td style="text-align: left">abline(a,b)</td>
      <td style="text-align: left">绘制斜率为b和截距为a的直线</td>
    </tr>
    <tr>
      <td style="text-align: left">abline(h=y)</td>
      <td style="text-align: left">在纵坐标y处画水平线</td>
    </tr>
    <tr>
      <td style="text-align: left">abline(v=x)</td>
      <td style="text-align: left">在横坐标x处画垂直线</td>
    </tr>
    <tr>
      <td style="text-align: left">abline(lm.obj)</td>
      <td style="text-align: left">画由lm.obj确定的回归线(参照第五章)</td>
    </tr>
    <tr>
      <td style="text-align: left">rect(x1, y1, x2, y2)</td>
      <td style="text-align: left">绘制长方形,(x1, y1)为左下角,(x2,y2)为右上角</td>
    </tr>
    <tr>
      <td style="text-align: left">polygon(x, y)</td>
      <td style="text-align: left">绘制连接各x,y坐标确定的点的多边形</td>
    </tr>
    <tr>
      <td style="text-align: left">legend(x, y, legend)</td>
      <td style="text-align: left">在点(x,y)处添加图例,说明内容由legend给定</td>
    </tr>
    <tr>
      <td style="text-align: left">title()</td>
      <td style="text-align: left">添加标题,也可添加一个副标题</td>
    </tr>
    <tr>
      <td style="text-align: left">axis(side, vect)</td>
      <td style="text-align: left">画坐标轴,side=1时画在下边,side=2时画在左边,side=3时画在上边,side=4时画在右边。可选参数at指定画刻度线的位置坐标</td>
    </tr>
    <tr>
      <td style="text-align: left">box()</td>
      <td style="text-align: left">在当前的图上加上边框</td>
    </tr>
    <tr>
      <td style="text-align: left">rug(x)</td>
      <td style="text-align: left">在x-轴上用短线画出x数据的位置</td>
    </tr>
    <tr>
      <td style="text-align: left">locator(n, type=”n”, …)</td>
      <td style="text-align: left">在用户用鼠标在图上点击n次后返回n次点击的坐标(x, y);并可以在点击处绘制符号(type=”p”时)或连线(type=”l”时),缺省情 况下不画符号或连线</td>
    </tr>
  </tbody>
</table>

<h2 id="reference">Reference</h2>

<ul>
  <li>R for Beginners</li>
  <li>An Introduction to R</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[人體工學鍵盤鼠標組合]]></title>
    <link href="http://aleung.github.com/blog/2013/01/08/keyboard-and-mouse/"/>
    <updated>2013-01-08T23:00:00+08:00</updated>
    <id>http://aleung.github.com/blog/2013/01/08/keyboard-and-mouse</id>
    <content type="html"><![CDATA[<p>作為悲催的程序猿，每天的大部份時間都是陪伴鼠標鍵盤度過的，一套合適的鼠標鍵盤非常重要，可以降低得職業病的機率。尋找人體工學的鼠標鍵盤並不容易，現在這套用了好些時間了，感覺很滿意。</p>

<p><img src="http://aleung.github.com/blog/attachments/2013/1/keyboard_mouse.jpg" /></p>

<p>先說鍵盤，普通鍵盤其實並不符合雙手自然的角度，如果要能讓雙手自然，左右手鍵盤需要分離。因此，理想的鍵盤大概是這個樣子的：</p>

<p><img src="http://aleung.github.com/blog/attachments/2013/1/kb_adv-pro.jpg" /></p>

<p>這個是Kinesis Advantage Pro，我在荷蘭公司見過有同事用，在網上程序員社區也受到推薦。</p>

<p>還有這個怪樣子的DataHand，手指已經不僅是向下敲鍵盤了，而是每個手指上下左右各個方向都是不同的鍵。</p>

<p><img src="http://aleung.github.com/blog/attachments/2013/1/datahand.jpg" /></p>

<p>上面說的鍵盤不僅僅怪異，也买不起。前者$359，後者更是近千美元。更何況即使有錢，在國內也買不到。因此我只能選擇還算中規中矩的<a href="http://www.microsoft.com/hardware/en-us/p/natural-ergonomic-keyboard-4000">微軟人體工學鍵盤4000</a>，這款鍵盤算是評價不錯，價錢也可接受，國內可以直接買到。它的左右手鍵盤區並沒有分離得很遠，但剛好分開一個夾角，跟雙手自然擺放時的角度一樣。左右手分開鍵盤區要求指法一定要正確，還好我到手後在一個下午裏就已經適應了。</p>

<p><img class="right" src="http://aleung.github.com/blog/attachments/2013/1/microsoft-mouse-6000.jpg" /> 鼠標我開始用的是<a href="http://www.microsoft.com/hardware/en-us/d/natural-wireless-laser-mouse-6000">微軟人體工學霸雷鯊6000</a>（已經停產），它的好處是傾斜的表面讓手腕不需要向內旋轉。但是用了一段時間感覺還是未達理想程度，主要問題是我移動鼠標時通常前臂放在桌面上是不動的，僅靠手腕的活動，時間長了手腕還是覺得累。</p>

<p>後來在網上看了不少資料，軌跡球可能可以解決這個問題，不需要手腕的動作，依靠手指移動就可以了。但是，對於軌跡球的評價好壞很極端，要麼說很好用要麼說根本沒用，估計這個東西的適應比較困難。但要真正用起來才會知道是否適合，最後還是下定決心買一個來試一下。軌跡球始終屬於小眾產品沒有推廣開來，產品甚至越出越少，市場上現在可買到的沒幾款，相對鼠標來說價錢也貴不少（其實結構、元件都差不多）。最終買的是<a href="http://www.kensington.com/kensington/us/us/p/1444/K64325/expert-mouse%C2%AE.aspx">Kensington Expert Mouse</a>（淘寶有售），明明是trackball要叫做mouse，可見trackball不受落。選擇這個是因為球體夠大，而且是可以用食指中指來滾動球體。Logitech M570 本來也不錯，但聽說拇指球用起來不夠靈活，拇指也容易累。中置球體的另外一個好處是左右手通用，我本來習慣用右手的，但那個鍵盤實在太霸氣了，把軌跡球放右邊，手在鍵盤和軌跡球間切換要移動很遠，於是就換用左手了。剛買回來，球滾動不大順滑，有點澀的感覺，真有些失望，但用了一兩個星期後就好很多了，現在操作起來絲柔順滑，阻尼感恰到好處，應該是球的三個支撐點需要一段時間磨合。軌跡球剛用起來確實不是那麼容易上手，操作會比較笨拙，比用鼠標慢很多，但是多花些時間適應，大概幾天到一周就可以上手了。</p>

<p>總之，現在對這套組合非常滿意。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[怎样在OSX上adb连接小米2]]></title>
    <link href="http://aleung.github.com/blog/2012/12/30/mi2-usb-debug-on-osx/"/>
    <updated>2012-12-30T20:24:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/12/30/mi2-usb-debug-on-osx</id>
    <content type="html"><![CDATA[<p>小米2手机在Mac OSX上，adb识别不到设备，Eclipse的DDMS也连不上设备，这样手机就不能用来开发了。实际上，只有在Windows上才需要安装USB驱动程序，在Linux、OSX上并不需要，设别不到小米2手机是因为adb不知道这手机的USB Vendor ID。Android SDK<a href="http://developer.android.com/tools/device.html">文档</a>里就列出了一些Android设备厂商的vendor ID，不过当然不包括小米，因此要自己找出小米的vendor ID。用IORegistryExplorer（据说是包含在Developer Tool里，反正我的机器上装了）可以查看连接上的USB设备的信息。选择IOUSB，可以看到名为“MI 2”的设备，idVendor是0x2717。</p>

<p>将这个Vendor ID作为独立一行加进文件 ~/.android/adb_usb.ini 中。装了Android SDK这个目录和文件应该就存在的，如果不存在就自己创建。修改完adb_usb.ini后执行 adb kill-server 重启adb，再执行 adb devices，就能看到小米2手机了。再打开Eclipse，也能够正常设别到手机，一切OK。</p>

<p><img src="http://aleung.github.com/blog/attachments/2012/12/osx_usb.jpg" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[四儿子无望，粗粮也好吧]]></title>
    <link href="http://aleung.github.com/blog/2012/12/23/mi2/"/>
    <updated>2012-12-23T14:03:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/12/23/mi2</id>
    <content type="html"><![CDATA[<p><img src="http://aleung.github.com/blog/attachments/2012/12/mi2_focus_01s.jpg" /></p>

<p>Xperia U 手機用了半年，<a href="http://aleung.github.com/blog/2012/07/22/xperia-u/">開始感覺</a>還不錯，可是升級到ICS之後就慢得不行，歸咎下來應該還是因為RAM太小只有512M。於是動了換機的念頭。本來看中的是人稱Google四兒子的 Nexus 4，高配置白菜價，還有Google最新系統的保證，可是開賣以來奇貨可居，市場價炒到上三千。幾個月內都是沒什麼希望買到了。本來我是沒有關注小米2的，偶然的機會朋友可以買到現貨，問我要不要，上網查了一輪，發現小米2也不錯，於是就買了。用了10天，感覺挺滿意。</p>

<p>對於國產手機，最關心的是能不能用Google服務，有沒有ROM可以刷。行貨的閹割系統對於我來說是根本不能用的。小米做得還不錯，保留了Google Service Framework，可以添加Google帳號同步，Google Play等應用自己裝上就可以了。小米手機不算開放，沒有找到任何第三方的ROM，但好在小米除了MIUI外還是提供了原生Android系統ROM，如果不喜歡MIUI還是可以用回native Android。小米2的操作系统已經超越了ICS，是Android 4.1 Jelly Bean，除了四儿子是4.2，小米2也算是版本最高的一款Android手机了吧。手機到手後，刷了個MIUI開發版，因為穩定版不提供root權限。個人感覺MIUI的定製的度把握得比較合適，把很多系統級的有用的功能集成進去了，例如來電短信攔截，LBE的權限管理，通知欄開關等等，而又沒有像其他廠商那樣內置一大堆用不著又刪不掉的應用。因此我試了一下還是決定保留MIUI。</p>

<p>唯一不喜欢的是MIUI的launcher。仿照iOS将图标全平铺在桌面上，用起来不方便；它为第三方应用的图标都缩小并加上一块灰绿色背景，难看死了，本来应用精心设计的透明背景图标都被它搞成一块块牛粪。MIUI的设计风格不错的，真不知道为什么这个launcher会搭配得那么丑，即使自己创建主题将那个灰绿背景改成透明，图标还是被缩小了不好看。我另外找到了一個launcher：<a href="https://play.google.com/store/apps/details?id=com.dlto.atom.launcher">Atom Launcher</a>，界面風格簡潔，功能細節也很好，這下就完美了。</p>

<p>小米2給我最大的感受是显示非常细腻，特别是低磅数的Roboto字体特别干净秀气。342ppi的屏幕达到视网膜屏的标准，其实现在新出的好多手机都是视网膜屏了，只不过现在已经不再新鲜，厂商也不会拿这来做特别宣传。Android从ICS起缺省的是Holo蓝色主题，MIUI换成了自己标志性的亮橙色，大片白色背景，黑色/灰色字体加上亮橙的点缀，整个风格很现代和清新。</p>

<p>剛到手時，對尺寸不太適應，讓我覺得蘋果說的3.5寸是最適合的手機屏幕尺寸不無道理。現在慢慢有些習慣了，但是單手操作始終還是有些彆扭，比如用右手操作，左上角和右下角的按鈕都不容易按到，還是雙手會方便些。</p>

<p>當然啦，新手機最爽的事情就是2G的RAM，運行的順暢程度跟舊手機比真是一個天一個地，看到什麼應用都想裝就裝啦。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我的首個半馬拉松]]></title>
    <link href="http://aleung.github.com/blog/2012/12/11/my-first-half-marathon/"/>
    <updated>2012-12-11T22:25:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/12/11/my-first-half-marathon</id>
    <content type="html"><![CDATA[<p>11月18日，廣州首屆馬拉松賽，也是我跑的第一次半馬拉松。過去大半個月了，還是記錄一下吧。</p>

<p>看回以前寫的blog，應該是在2005年底開始跑步的，也不記得當時爲什麼突然有了要經常性跑步的想法。那時傍晚下班後在天河公園跑，跑步是作爲鍛鍊和放鬆，一次跑半小時左右，最多5、6公里，根本不敢想象自己能跑21公里的半馬拉松。雖然跑了好多年，但都是斷斷續續，有時一停就幾個月，跑的頻率也低，最多一週兩次，一直都是維持在只能連續跑5公里左右水平。</p>

<p>2008年下半年腰椎間盤突出，最嚴重時連走路都一瘸一瘸的，當時真害怕恢復不了，沒法再做運動了。幸好恢復得很快，11月起可以慢跑鍛鍊，那兩三個月跑得比較頻密，到年底跑的狀態還不錯，同樣的距離比之前跑得更輕鬆。</p>

<p>2009年開始嘗試跑長一點的距離，跑了幾次8到10公里左右，但也沒堅持訓練。10月份Nike在廣州舉辦10公里跑，第一次參加了正式的長跑活動，成績58:30，完成了自己跑進1小時的目標<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>。試過後覺得參加跑步活動很好玩，打算以後都繼續參與。</p>

<p>2010年亞運會，Nike沒有辦跑步活動，2011年11月，Nike又舉辦10公里跑，這次賽前就比較認真的做了兩個月的訓練計劃，專門練習了提高步頻，效果還是比較顯著的，成績比預想的好不少，48:29，步速邁進了5分鐘每公里大關<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>。</p>

<p>那時還報名了2012年2月的香港半程馬拉松，接下來幾個月跑的狀態都很好，週末訓練跑了幾次17、18公里，又跑了上白雲山的路線<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>，感覺信心很足，心中還在盤算着目標定在兩小時還是2:15合適。誰知臨近比賽前兩天開始出現感冒跡象，週六中午到了香港，去領取選手包後就開始發燒，下午晚上都在酒店燒得迷迷糊糊的。週日早上病好了，但也不能去跑步了，第一次半馬拉松就這樣錯過。然後對跑步的興趣又一次陷入低谷，一週跑不了一次。</p>

<p>2012年初就看到廣州11月要舉辦馬拉松賽的消息，但一直到九月初都沒有見到正式籌備工作開展，正在想是否搞不成的時候，官方報名消息就出來了。接下來就維持了一個多月的訓練，11月18日開跑，總的來說比較輕鬆的完成了首次半馬拉松。</p>

<p>跑完時比較興奮，發了好幾條tweets：</p>

<blockquote>
  <p>我的首个半马拉松，官方計時1:51:23，完成了两小时内的目标。前十公里留力比较多，下次可以不用那么保守。</p>
</blockquote>

<blockquote>
  <p>參加大規模長跑活動的感覺跟平常自己跑很不一樣，喜歡跑步的朋友都值得嘗試一下，無所謂速度，能在關門時間前跑完就行了。很多人一起跑，興奮度高很多，超過自己平常速度也會覺得很輕鬆；寬闊的馬路車輛全不見了，讓你暢快的跑在路中心；路旁觀衆的鼓勵讓你心中充滿溫暖。</p>
</blockquote>

<blockquote>
  <p>马拉松赛道上，视障参赛者由引导员陪同赛跑，两人的手用带子系在一起。路上见到好多组，男女都有。看到他们，我觉得很感动，我们跑步，再困难也难不过他们。</p>
</blockquote>

<p>跑完後，又沒有了目標了。不知道以後會不會去跑個全馬，半馬跟全馬的區別還是挺大的，對我來說最重要的是不要把膝蓋跑傷了，享受跑步的樂趣，而不是追求成績。</p>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p><a href="http://aleung.github.com/blog/2009/09/25/Prepare-10-km-run/">准备10km跑</a><a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p><a href="http://aleung.github.com/blog/2011/11/15/Nike-Lunar-Run-10-/">Nike Lunar Run 10公里跑总结</a><a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p><a href="http://aleung.github.com/blog/2011/12/26/Baiyun-mountain-running/">白云山跑步</a><a href="#fnref:3" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android: 在應用中設定locale]]></title>
    <link href="http://aleung.github.com/blog/2012/10/06/change-locale-in-android-application/"/>
    <updated>2012-10-06T00:25:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/10/06/change-locale-in-android-application</id>
    <content type="html"><![CDATA[<p>近幾天把以前做的跑步步频训练软件 <a href="https://play.google.com/store/apps/details?id=leoliang.runningcadence">RunningCadence</a> 加上了多語言支持，可以在應用中設定界面以及語音播報所用的語言。</p>

<p>對多語言的支持，Android已經做得很完善，開發者只需要在應用中加入各種locale的資源文件。但是，應用只會使用系統全局設置的locale，而要在應用自己的設定中選擇locale，以及要讓設定立即生效，就需要開發者自己去實現了。</p>

<p>本來，一般應用並沒必要自己提供語言設定，用系統全局設定就好了。但這個 RunningCadence 使用了語音合成(TTS)功能，而一般手機上安裝的TTS引擎支持的語言都有限，如果TTS不支持系統locale的語言，那就聽不到聲音了，所以需要花力氣去搞這個應用內的語言選擇。</p>

<h2 id="localelocale">讓應用啓動時使用自己設定的locale，而非系統locale</h2>

<p>開發應用時要爲不同locale準備不同的資源，在應用中通過 <a href="http://developer.android.com/reference/android/content/res/Resources.html">Resources</a> 類來加載資源，各個界面組件的構建都需要用到資源。而具體資源如何選擇是受 <a href="http://developer.android.com/reference/android/content/res/Configuration.html">Configuration</a> 影響的，Configuration帶有設備的硬件相關配置信息（如屏幕分辨率，屏幕方向）和系統全局配置信息（如locale），由系統底層框架提供。</p>

<p>應用啓動時，Configuration中的locale會被設置爲系統locale。應用若要使用自己的locale，就必須在創建界面之前，將Resources裏的Configuration更改。</p>

<p>這個更改在application的 onCreate() 裏面做最合適，對應用全局生效，因爲它在任何activity創建之前就執行了，不再需要在各個activity裏做任何事情。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">	<span class="n">setLocale</span><span class="o">();</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLocale</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">	<span class="n">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="n">getLocaleFromPref</span><span class="o">();</span>
</span><span class="line">	<span class="n">Locale</span><span class="o">.</span><span class="na">setDefault</span><span class="o">(</span><span class="n">locale</span><span class="o">);</span>
</span><span class="line">	<span class="n">Configuration</span> <span class="n">config</span> <span class="o">=</span> <span class="n">getBaseContext</span><span class="o">().</span><span class="na">getResources</span><span class="o">().</span><span class="na">getConfiguration</span><span class="o">();</span>
</span><span class="line">	<span class="n">overwriteConfigurationLocale</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">overwriteConfigurationLocale</span><span class="o">(</span><span class="n">Configuration</span> <span class="n">config</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">	<span class="n">config</span><span class="o">.</span><span class="na">locale</span> <span class="o">=</span> <span class="n">locale</span><span class="o">;</span>
</span><span class="line">	<span class="n">getBaseContext</span><span class="o">().</span><span class="na">getResources</span><span class="o">()</span>
</span><span class="line">			<span class="o">.</span><span class="na">updateConfiguration</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">getBaseContext</span><span class="o">().</span><span class="na">getResources</span><span class="o">().</span><span class="na">getDisplayMetrics</span><span class="o">());</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>加了這段代碼後，應用啓動時就會根據 getLocaleFromPref() 返回的語言來顯示了，但是你會發現如果將手機屏幕轉一下，例如豎屏變爲橫屏，界面又會變回系統缺省語言，爲什麼呢？</p>

<p>系統底層框架會在configuration發生了變化時通知應用<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>。對application是調用 Application.onConfigurationChanged() 方法。對activity的處理採用那種方式，就與manifest文件中&lt;Activity&gt;的 android:configChanges 屬性配置相關：</p>

<ul>
  <li>如果發生的是configChanges中指定的事件，調用 Activity.onConfigurationChanged()，不重啓activity；</li>
  <li>否則重啓activity。</li>
</ul>

<p>屏幕的旋轉就是一種 runtime change，缺省情況下會觸發activity的重啓，也就是銷毀並重新創建activity<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>，重新創建時使用的是新的Configuration，裏面帶的又是系統locale，因此就造成了界面變回系統缺省語言。</p>

<p>爲了避免這種情況，需要在Application的 onConfigurationChanged() 裏面也對Configuration做修改。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onConfigurationChanged</span><span class="o">(</span><span class="n">Configuration</span> <span class="n">newConfig</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">	<span class="n">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="n">getLocaleFromPref</span><span class="o">();</span>
</span><span class="line">	<span class="n">Locale</span><span class="o">.</span><span class="na">setDefault</span><span class="o">(</span><span class="n">locale</span><span class="o">);</span>
</span><span class="line">	<span class="n">overwriteConfigurationLocale</span><span class="o">(</span><span class="n">newConfig</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
</span><span class="line">	<span class="kd">super</span><span class="o">.</span><span class="na">onConfigurationChanged</span><span class="o">(</span><span class="n">newConfig</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>做了這些後，應用就能使用自己的locale設定，而不是系統locale了。完整代碼例子可以參考RunningCadence源碼 <a href="https://github.com/aleung/RunningCadence/blob/c658e00bd24a23bd95369bf6e3d87254776ae2cb/RunningCadence/src/leoliang/runningcadence/Application.java">Application.java</a>。</p>

<h2 id="preferencelocale">讓應用preference中的locale設定修改立即生效</h2>

<p>應用通常會使用 Preference API 來構造用戶設定界面，在上一步完成後，用戶可以在應用preference裏設置locale，在應用重新啓動時會使用選定的locale。但是用戶在preference裏修改locale後是不會立即生效的，因爲修改沒有反映到 configuration 中去，而且對於已經存在的activity，界面組件都已經創建好了，界面上的文字不可能自動改變。</p>

<p>一種方案是讓整個應用重新啓動，所有資源都重新加載，所有界面都重新創建。我留意了一下，大部分提供應用內語言設定的應用都是這樣做的——在彈出對話框裏選擇語言並確認後，不會返回到設定頁面，而是顯示應用的入口界面——應用已經重啓了。在 RunningCadence 中，我不想用這種方法，因爲用戶體驗會不好——用戶在修改語言後，通常還要選擇另一個選項進行語音合成測試，看看TTS對新選擇的語言能否正常工作——如果應用重啓返回主界面，用戶就得再進入設定界面才能進行測試，一方面是操作麻煩了，另一方面界面無緣無故跳轉也會帶來困惑。</p>

<h3 id="configuration">在用戶修改設定後，更新Configuration</h3>

<p>更新Configuration的方法跟應用啓動時的做法一樣，可以重用 setLocale() 方法，問題是要能在合適的時機去調用。使用SharedPreference的修改通知機制可以做到這點。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PreferenceActivity</span> <span class="kd">extends</span> <span class="n">android</span><span class="o">.</span><span class="na">preference</span><span class="o">.</span><span class="na">PreferenceActivity</span> <span class="kd">implements</span>
</span><span class="line">		<span class="n">OnSharedPreferenceChangeListener</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">	<span class="c1">// ...</span>
</span><span class="line">
</span><span class="line">	<span class="nd">@Override</span>
</span><span class="line">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSharedPreferenceChanged</span><span class="o">(</span><span class="n">SharedPreferences</span> <span class="n">sharedPreferences</span><span class="o">,</span> <span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">		<span class="k">if</span> <span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;pref_language&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class="line">			<span class="o">((</span><span class="n">Application</span><span class="o">)</span> <span class="n">getApplication</span><span class="o">()).</span><span class="na">setLocale</span><span class="o">();</span>
</span><span class="line">			<span class="n">restartActivity</span><span class="o">();</span>
</span><span class="line">		<span class="o">}</span>
</span><span class="line">	<span class="o">}</span>
</span><span class="line">
</span><span class="line">	<span class="nd">@Override</span>
</span><span class="line">	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">		<span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class="line">		<span class="n">addPreferencesFromResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">preferences</span><span class="o">);</span>
</span><span class="line">		<span class="n">getPreferenceScreen</span><span class="o">().</span><span class="na">getSharedPreferences</span><span class="o">().</span><span class="na">registerOnSharedPreferenceChangeListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class="line">	<span class="o">}</span>
</span><span class="line">
</span><span class="line">	<span class="nd">@Override</span>
</span><span class="line">	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">		<span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
</span><span class="line">		<span class="n">getPreferenceScreen</span><span class="o">().</span><span class="na">getSharedPreferences</span><span class="o">().</span><span class="na">unregisterOnSharedPreferenceChangeListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class="line">	<span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>要注意這個listener的寫法，如果按照通常Android程序風格，使用匿名內部類來實現，就會發生詭異的問題，總是不會被回調。這個問題花了我好長時間，誤打誤撞解決了也沒明白什麼回事，寫這篇文章時才看見StackOverflow上有這個問題的<a href="http://stackoverflow.com/a/3104265/94148">根源解答</a>。</p>

<h3 id="locale">將已經存在的界面按照新locale重新顯示</h3>

<p>先分析哪些activity是需要重新顯示的，這需要對應用的 <a href="http://developer.android.com/guide/components/tasks-and-back-stack.html">task stack</a> 結構有一個審視。要知道在locale更改的時刻，哪些activity還在生存着，會在後續操作中重新變爲可見狀態，這些activity的界面需要重建。在RunningCadence裏比較簡單，就是PreferenceActivity本身和調用它的主activity。</p>

<p>要讓activity的界面按新locale重新顯示，最簡單的方法應該就是讓它重啓，這比起對每個界面元件都用重新加載資源去重設要簡單得多。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">restartActivity</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">	<span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">();</span>
</span><span class="line">	<span class="n">finish</span><span class="o">();</span>
</span><span class="line">	<span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>PreferenceActivity的重啓是在OnSharedPreferenceChangeListener得知設定發生了改變的時候進行，在上面的代碼例子裏已經顯示出來了。而主activity的重啓是在當用戶從PreferenceActivity中返回到主activity時，在onActivityResult() 中觸發。</p>

<p>完整代碼例子可以參考RunningCadence源碼 <a href="https://github.com/aleung/RunningCadence/blob/f0cdb98b42a94caa5c7e2cec1a8aa6abf91e73b9/RunningCadence/src/leoliang/runningcadence/PreferenceActivity.java">PreferenceActivity.java</a>。</p>

<h2 id="section">總結</h2>

<p>現在將思路理清了寫下來，感覺不算複雜，但是在做的過程中費了好多腦筋繞了不少彎路，邊上網查資料邊嘗試。Android的API Guides在ICS發佈後改進了好多，很多內容重寫過更清晰容易理解了，另外一個非常有價值的資源是<a href="StackOverflow.com">StackOverflow.com</a>。</p>

<p>我感覺，對於一般應用沒有太大必要去實現應用內的語言選擇。系統裏所有應用都使用統一的locale本來就挺好的。</p>

<p>如果應用的task stack結構複雜，需要重新顯示的activity很多，可能用重啓整個應用的方法更簡單一些。我不知道重啓應用是怎麼做到的，Android API裏面沒有現成的方法。不過若實現了應用重啓，應用內部各個Activity都不需要做任何額外處理了。</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>詳細機制見 <a href="http://developer.android.com/guide/topics/resources/runtime-changes.html">Handling Runtime Changes</a><a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>在 <a href="http://aleung.github.com/blog/2010/12/16/Android-activity-lifecycle-in-UML-state-machine-diagram">Android Activity Lifecycle in UML</a> 文中的狀態圖可以見到configChanged引發的狀態遷移。<a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java的volatile关键字的作用]]></title>
    <link href="http://aleung.github.com/blog/2012/09/17/Java-volatile-/"/>
    <updated>2012-09-17T00:00:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/09/17/Java-volatile-</id>
    <content type="html"><![CDATA[<ul>
  <li>Initial: 2008-12-04</li>
  <li>Updated: 2012-9-17</li>
</ul>

<p>Java内存模型中，有主内存和每个线程各自的工作内存，虚拟机和硬件可能会让线程工作内存优先存储于寄存器和高速缓存中，以提高性能。</p>

<p>所有变量都存储在主内存中，线程工作内存中保存了此线程使用到的变量的副本。工作内存在线程之间是隔离的，对其他线程不可见。线程对变量的所有操作都必须在工作内存中进行，修改后的变量副本要写回主内存。这样就会出现同一个变量在某个瞬间，在一个线程的工作内存中的值可能与另外一个线程工作内存中的值，或者主内存中的值不一致的情况。</p>

<p>一个变量声明为volatile，就意味着这个变量被修改时其他所有使用到此变量的线程都立即能见到变化（称之为可见性）。具体是在每次使用前都要先刷新，以保证别的线程中的修改已经反映到本线程工作内存中，因此可以保证执行时的一致性。以下例子展现了volatile的作用：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StoppableTask</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
</span><span class="line">  <span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">pleaseStop</span><span class="o">;</span>
</span><span class="line">
</span><span class="line">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="k">while</span> <span class="o">(!</span><span class="n">pleaseStop</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">      <span class="c1">// do some stuff...  </span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line">
</span><span class="line">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tellMeToStop</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">pleaseStop</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>假如pleaseStop没有被声明为volatile，线程执行run的时候检查的是自己的副本，就不能及时得知其他线程已经调用tellMeToStop()修改了pleaseStop的值。</p>

<p>Volatile一般情况下并不能代替sychronized，因为volatile不能保证操作的原子性，即使只是i++，实际上也是由多个原子操作组成：read i; inc; write i，假如多个线程同时执行i++，依然可能由于不同线程交替执行而出现写入脏数据的情况。也就是说，如果对变量值的修改需要依赖于变量之前的值，那么volatile不能保证一致性，需要用sychronized，或者使用atomic类型(java.util.concurrent.atomic.*)；而上面的代码例子是可以使用volatile的典型场景。</p>

<p>Volatile的另外一个作用是禁止指令的重排序优化。在一般情况下，Java执行语句的顺序可能会因为自动优化而修改，例如下面的例子，initialized的赋值有可能在doInitialize()之前就执行了，线程B就有可能不会正确的等待初始化完成。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kt">boolean</span> <span class="n">initialized</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="c1">// run in one thread</span>
</span><span class="line"><span class="n">doInitialize</span><span class="o">();</span>
</span><span class="line"><span class="n">initialized</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="c1">// run in another thread</span>
</span><span class="line"><span class="k">while</span> <span class="o">(!</span><span class="n">initialized</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">  <span class="n">sleep</span><span class="o">();</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>如果将initialized声明为volatile，就能保证它的执行顺序不会被改变（但JavaSE 5之前的版本依然会有问题）。</p>

<p>以前在讲述Java与C++区别的时候，有个著名的例子是double-checked locking在Java中不能使用，就是执行顺序优化造成的问题。但自JavaSE 5起，配合volatile的使用是可以实现double-checked locking的。</p>

<p>Reference：</p>

<ul>
  <li><a href="http://www.javamex.com/tutorials/synchronization_volatile.shtml">http://www.javamex.com/tutorials/synchronization_volatile.shtml</a></li>
  <li><a href="http://www.ibm.com/developerworks/cn/java/j-jtp06197.html">http://www.ibm.com/developerworks/cn/java/j-jtp06197.html</a></li>
  <li><a href="http://book.douban.com/subject/6522893/">深入理解Java虚拟机</a></li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[色彩管理 (2)]]></title>
    <link href="http://aleung.github.com/blog/2012/09/15/color-management-2/"/>
    <updated>2012-09-15T00:56:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/09/15/color-management-2</id>
    <content type="html"><![CDATA[<p>色彩管理的<a href="http://aleung.github.com/blog/2004/11/12/Color-management-1">第一篇</a>是在2004年写的，当时本来想连续写，可写了一篇就没有下文了。现在再来继续色彩的话题，不过这次的主题其实不算色彩管理，而是看看色彩的本质是什么。</p>

<p>颜色是什么？学物理的时候说太阳光通过菱镜会分离成彩色的光带，不同颜色的光的波长是不一样的。这给我们一个印象：颜色就是可见光波长这个物理量的反映。但是问题来了，白色对应什么波长的光？为什么红光和绿光混合在一起变成了黄光，难道混合后波长产生变化了？原因在于，颜色并不是某一個物理量的直接反映，而是人对光线的心理反映，称之为色觉。</p>

<p><img class="right" src="http://aleung.github.com/blog/attachments/2012/9/eye.jpg" /> </p>

<p>人眼有三种色彩感受器（视锥细胞），每种感受器可以感应不同波长范围的光，分别的感受峰值波长为：420nm，534nm，564nm，差不多相当于蓝、绿、红三色光的波长。对于某一种光谱，三种感受器得到三组信号送往大脑，大脑根据这三组信号值的不同组合感知到不同的色彩。</p>

<p>现实世界中的光线通常都不会是单一波长的（只有激光光源产生的才是单一波长的光吧，要么是经过分光镜得到的），而是不同波长组合的混合光。视觉感受器并不能区分这些光谱，反正各种感受器只对自己能感应的波长范围内的光作出反应，最后大脑拿到的就是三组信号而已。不同的光谱组合的光线，可能对三种视觉感受器产生的刺激恰好是一样的，这样大脑就会将它们感受为同一种颜色，术语称为“异谱同色”。例如波长600nm左右的光线人感受是黄色，而波长540nm绿光和700nm红光一定强度比例的混合，人感觉到的也是黄色。</p>

<p>我曾经在之乎问过一个问题：人眼若多一种新的视椎细胞可感应可见光范围内的另外一个波长的光，人看到的色彩会有什么变化吗？看到的颜色更多？ 后来我想明白了，是会看到更多的颜色的，准确的说，是能够分辨出更多不同的颜色。在只有三种感受器时，有些不同波长组合的混合光产生的刺激是一样的，大脑区分不出，将它们当作同样的颜色，但假若增加另一种波长的感受器后，这个感受器感应到的刺激不同，就能够分辨为不同色彩了。至于这个颜色是什么？我们不可能知道，因为颜色仅仅是一种心理反应。如此类推，不同动物看到的色彩也是不一样的，因为不同动物眼睛的视锥细胞的波长响应曲线不同，而且数量也不一定一样。假如有某种外星人有四种甚至更多的色彩感受器，那他们会认为地球人全是色盲，地球人到他们的世界里可能连分辨交通灯都有问题——如果他们还用交通灯。另外，所谓三原色，也是针对人而言的。</p>

<p>既然色彩只是种心理反应（感觉），那为了准确描述色彩和进行分析，就需要建立色彩模型。根据关注的角度不同，不同的研究者拿出了不同的色彩模型，例如孟塞尔颜色立体模型、CIE L* a* b* 模型。其中 CIE XYZ 模型应该是最能反映人的颜色视觉的，因为它的制定就是通过大量实验来测定人对三种特定波长光线S、M、L（约对应于红绿蓝）的刺激值X，Y，Z。实验方式是让人同时观察目标色光线和SML三组标准光的混合光，调节S/M/L的光强，使得人眼感觉混合光和目标色光线的颜色完全一样，从而得出目标色的XYZ值。CIE XYZ色彩空间是色彩管理的基础。</p>

<p>CIE XYZ定义了一个三维空间，展现起来不如二维图形直观。经常用来表示色彩空间大小的二维马蹄型图称为CIE xy色度图，如下图。它的纵横座标xy是根据XYZ推导出来的，x=X/(X+Y+Z), y=Y/(X+Y+Z), z=Z/(X+Y+Z), x+y+z=1。彩色的马蹄形范围表示人眼可见的全部色彩范围。在数码相机和电脑显示中使用的RGB色彩空间在CIE xy色度图中反映为三角形范围，三个顶点分别为R/G/B三原色。</p>

<p><img src="http://aleung.github.com/blog/attachments/2012/9/gamut.jpg" alt="" /></p>

<p>不考虑印刷，摄影爱好者一般会接触到的色彩空间也就是AdobeRGB和sRGB。从图中可见，AdobeRGB的色域比sRGB广，特别是在蓝绿色系方面，AdobeRGB能够表现的色彩比sRGB丰富很多。我查找不到资料描述各种数码相机的感光元件能够记录下来的色域有多大，但一般的说法是一般数码单反所能记录的色彩范围都比sRGB广，接近或大于AdobeRGB。因此，专业的摄影都会选择AdobeRGB色彩空间来保存图像文档。但问题是，我们的显示器并不能展现这么广的色域，民用型号通常都只能再现sRGB色彩空间或更小一点（广色域显示器会比sRGB大，但一般还是达不到AdobeRGB），因此照片中记录的部分颜色是无法在显示器上原汁原味的再现出来的（这里先不考虑显示器没有校准导致偏色问题），超出设备色彩空间的颜色只能用接近的来替换，例如翠绿色的海水就没有那么漂亮了。另外一个问题是有些软件，例如不是最新版本的浏览器，是不支持色彩管理的，它不会将照片的色彩空间映射到显示器的色彩空间以保持在可显示范围内的颜色一致，而是将照片中的RGB值当作设备色彩空间的值来直接显示。如果照片用的是sRGB还好，因为显示器本身大致符合sRGB，颜色偏差不会太多，但若照片是用色域更广的AdobeRGB的，色彩偏差就严重了。所以数码相机的说明书上一般会建议如果照片仅在电脑上观看最好选择sRGB。</p>

<p>不过，数码相机的色彩空间设置仅仅是针对JPG格式的，如果用RAW格式，保存的是传感器得到的原始值，实际上是数码相机设备色彩空间，而不是任何标准色彩空间。当在电脑中用RAW处理软件打开时，会将照片由设备色彩空间映射到软件设定的工作空间。我用Apple Aperture打开Nikon的RAW，看到它是被标识为AdobeRGB色彩空间。用数码单反的话，最好还是选择RAW格式，因为记录的信息多，后期处理的余地就大很多。</p>

<p>See also:</p>

<p><a href="http://aleung.github.com/blog/2004/11/12/Color-management-1">色彩管理(1)</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[广州跑步路线：二沙岛]]></title>
    <link href="http://aleung.github.com/blog/2012/09/10/running-route-ersha/"/>
    <updated>2012-09-10T22:13:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/09/10/running-route-ersha</id>
    <content type="html"><![CDATA[<p><img src="http://aleung.github.com/blog/attachments/2012/9/ersha_sat.jpg" alt="" /></p>

<p>环岛一周约4.4km，其实只能算环半岛，因为岛西面一大段的沿江堤岸是公众不能进入的。车道大部分是沥青路面，晴澜路段水泥路面，人行道是铺石路面。环岛道路汽车不多，在注意安全的前提下可以靠边跑车道。</p>

<p>虽然算不上有什么景观，但二沙岛上的都是别墅和高级会所，环境幽静，江边视野开阔，跑起来挺舒服。</p>

<p>晚上晴波路音乐厅美术馆一段江边比较热闹点，有游客、玩单车和玩音乐的，其他路段都比较僻静，特别的北面晴澜路段。但每隔一段距离就有保安坐在路旁，毕竟这里是富人区，治安有保障。</p>

<p>岛中央是几个大草坪，上面有橡胶铺设的步道，跑步也不错，但就是拐弯多，断断续续，总长度也不够长。</p>

<p>岛中央大通路/烟雨路有公交车途经。往东过广州大桥可以接着跑珠江新城临江大道，往西沿大通路过桥也可以接着沿江边跑，因此二沙岛可以作为沿珠江跑路线的一段。</p>

<p>总体来说也是可以推荐的跑步路线。</p>

<p><img src="http://aleung.github.com/blog/attachments/2012/9/ersha_map.jpg" alt="" /></p>

<p>其他跑步路线介绍：<a href="http://aleung.github.com/blog/2012/09/09/running-route">广州跑步路线：索引</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[广州跑步路线: 麓湖]]></title>
    <link href="http://aleung.github.com/blog/2012/09/09/running-route-luhu/"/>
    <updated>2012-09-09T21:13:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/09/09/running-route-luhu</id>
    <content type="html"><![CDATA[<p><img src="http://aleung.github.com/blog/attachments/2012/9/luhu_sat.jpg" alt="" /></p>

<p>麓湖的跑步路线是环绕着湖一周的路。路面包括木栈道、柏油车道、砖铺人行道，麓湖路属于绿道系统的部分有木栈道，其余环湖路线的人行道很窄，可以跑到车道边上，但有来车时需要注意安全。</p>

<p>麓湖是广州为数不多的大湖泊，比一般公园的湖要大很多，周边都是山头绿地，环境和景色都不错。可惜环湖的车道虽然不是主干道，但来往车辆还是不少，汽车尾气导致空气还是一般。</p>

<p>虽然周边环境偏僻些，但白天游人不少，路上也不时会见到跑友，安全不成问题。我没有晚上去跑过，估计会比较僻静，安全上需要小心。附近麓景路、麓湖路都有公交车站。</p>

<p>环湖一圈约3.5km，总上升59m，基本上不算多大起伏。</p>

<p><img src="http://aleung.github.com/blog/attachments/2012/9/luhu_elevation.jpg" alt="" /></p>

<p>总体来说是不错的跑步路线，推荐。</p>

<p><img src="http://aleung.github.com/blog/attachments/2012/9/luhu_map.jpg" alt="" /></p>

<p>其他跑步路线介绍：<a href="http://aleung.github.com/blog/2012/09/09/running-route">广州跑步路线：索引</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[广州跑步路线：索引]]></title>
    <link href="http://aleung.github.com/blog/2012/09/09/running-route/"/>
    <updated>2012-09-09T21:09:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/09/09/running-route</id>
    <content type="html"><![CDATA[<p>这一系列博文记录我跑过的路线。</p>

<ul>
  <li><a href="http://aleung.github.com/blog/2012/09/09/running-route-luhu/">麓湖</a></li>
  <li><a href="http://aleung.github.com/blog/2012/09/10/running-route-ersha/">二沙岛</a></li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Understanding WebLogic WorkManager]]></title>
    <link href="http://aleung.github.com/blog/2012/08/10/understanding-weblogic-workmanager/"/>
    <updated>2012-08-10T22:54:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/08/10/understanding-weblogic-workmanager</id>
    <content type="html"><![CDATA[<p>Since WebLogic Server 9.0, new concepts for workload management is introduced. WorkManager replaces execute queue as defined in earlier releases.</p>

<p>All WorkManagers share a common thread pool and a priority-based queue. The size of the thread pool is determined automatically by the kernel and resized as needed.  Priority of the requests is dynamic and computed internally to meet the stated goals. </p>

<p>The thread pool is so-called self-tunning. It monitors the overall throughput every two seconds and uses the collected data to determine if thread count needs to change. Present thread count, the measured throughput, and the past history is taken into account by the algorithm to determine if the thread count needs to increase or decrease, and new threads are automatically added to the pool or removed, as needed.</p>

<p>It’s no longer have to (and is unable to) configure thread counts on a WorkManager nor the common thread pool. However, it’s possible to affect how server prioritizes work and allocates threads by parameters defined in WorkManager. Each WorkManager can contain following types of components:</p>

<ul>
  <li>Request class 
    <ul>
      <li>Fair-share</li>
      <li>Response-time goal</li>
      <li>Context based</li>
    </ul>
  </li>
  <li>Constraints
    <ul>
      <li>Minimum threads constraint</li>
      <li>Maximum threads constraint</li>
      <li>Capacity</li>
    </ul>
  </li>
</ul>

<p>Request class affects how requests are prioritized. Fair-share request class changes thread usage weight of a WorkManage, which is by default 50. Response-time goal request class specifies the response-time goal in milliseconds. Context-based request class is a compound request class that provides a mapping between the request context and the above two request classes. With context-based request class, it’s possible to specify different request classes for the same servlet invocation depending on the user associated with the invocation.</p>

<p>A constraint defines minimum and maximum numbers of threads allocated to execute requests and the total number of requests that can be queued or executing before WebLogic Server begins rejecting requests. Constraint is referenced in WorkManager by constraint name. So a constraint can be shared by several WorkManagers and set the common limit.</p>

<p>Minimum threads constraint makes sure that during periods of high workloads, there would still be a certain number of threads from the self-tuning thread pool available to process work requests for all work managers that reference the minimum threads constraint. Using the minimum threads constraint could result in some side-effects. Users should consider adding a minimum threads constraint to a work manager configuration when it is critical that progress must be made for an application even when the WLS server is under very heavy load, such as work that would have resulted in server-to-server deadlock if not being processed promptly. It is not to be used as a mean of prioritizing workload among different work managers. </p>

<p>The maximum threads constraint limits the number of threads in the self-tuning thread pool that can be used for executing work for all work managers that references the same constraint. The maximum threads constraint is not designed as a mean to prioritize workloads among different work managers. It is most useful when there are other known limitations where a hard upper limit should be put on the number of threads that should be assigned for processing work requests, and that allocating more threads for processing the workload would not increase the overall throughput.</p>

<p>A typical use case of maximum threads constraint is to take a data source connection pool size as the max constraint.</p>

<pre><code>&lt;max-threads-constraint&gt;
  &lt;name&gt;MyConstraint&lt;/name&gt;
  &lt;pool-name&gt;MyDataSource&lt;/pool-name&gt;
&lt;/max-threads-constraint&gt;
</code></pre>

<p>The capacity constraint defines the maximum number of requests that can be queued (waiting for thread) or are executing. Overload action, e.g. refuse with HTTP response code 503, is taken after the capacity is reached. </p>

<p>I draw a picture to show the threadpool and queue. Requests dispatched with different WorkManager are in different color.</p>

<p><img src="http://aleung.github.com/blog/attachments/2012/8/workmanager.jpg" alt="" /></p>

<ul>
  <li>Self-tuning thread pool thread allocation ratio amoung WorkManagers is affected by request class. </li>
  <li>Minimum threads constraint limits: never queue request, unless <code>executing &gt;= min-threads-constraint.count</code></li>
  <li>Maximum threads constraint limits: <code>executing &lt;= max-threads-constraint.count</code></li>
  <li>capacity contraint limits: <code>executing + queued &lt;= capacity.count</code></li>
</ul>

<p>WorkManager can be created for a specific application or module (ejb/war), which is called application-scoped WorkManager. If there is no special requirement on individual application or module, you can create global Work Managers that are available to all applications and modules. An application uses a globally-defined Work Manager as a template. Each application creates its own instance, this means that each application has its own default WorkManager that is not shared with other applications. WebLogic Server provides a built-in default Work Manager which may be sufficient for most application requirements.</p>

<p>Reference:</p>

<ul>
  <li><a href="http://www.oracle.com/technetwork/articles/entarch/workload-management-088692.html">Workload Management in WebLogic Server 9.0</a></li>
  <li><a href="https://blogs.oracle.com/WebLogicServer/entry/threads_constraints_in_work_ma">Threads Constraints in Work Managers</a></li>
  <li><a href="http://docs.oracle.com/cd/E15051_01/wls/docs103/config_wls/self_tuned.html">Using Work Managers to Optimize Scheduled Work</a></li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[apigee]]></title>
    <link href="http://aleung.github.com/blog/2012/07/31/apigee/"/>
    <updated>2012-07-31T23:20:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/07/31/apigee</id>
    <content type="html"><![CDATA[<p><a href="http://apigee.com/">Apigee</a> is hot recently. It has raised $20 million in its fifth round of funding. What magic it has? I spent some time today to have a look at it.</p>

<p>Apigee is an API management platform and services company. It benefits both API providers and developers who build their apps with APIs.</p>

<h2 id="apigee-enterprise">Apigee Enterprise</h2>

<p>Apigee Enterprise product is an API proxy plus developer portal.</p>

<p>Usually when an organization open its internal services or data to external, it develops the API and exposure it, with necessary document published. Application developers learn the API by reading the document, and then code to use the API.</p>

<p><img src="http://aleung.github.com/blog/attachments/2012/7/api.png" alt="" /></p>

<p>Apigee helps API provider by providing API management, security, analytics etc. It provides developer portal for API provider to management developer onboarding, and also help developer to learn the API by playing with it.</p>

<p><img src="http://aleung.github.com/blog/attachments/2012/7/api_with_apigee.png" alt="" /></p>

<h2 id="console-to-go">Console To-Go</h2>

<p>Apigee Enterprise features are not available to free subscriber of Apigee, excepts the console that let developer learn an API by playing with it. Apigee opens this service to free subscriber as Console To-Go.</p>

<p>I try to create my own Console To-Go:</p>

<p>Create an API on Google Application Engine: <a href="http://api-playground.appspot.com/time">time API</a> , it simply return the current time since epoch.</p>

<p>Write the WADL for the API.</p>
<div><script src="https://gist.github.com/3214300.js?file="></script>
<noscript><pre><code>&lt;application xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
             xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;
             xmlns:apigee=&quot;http://api.apigee.com/wadl/2010/07/&quot;
             xmlns=&quot;http://wadl.dev.java.net/2009/02&quot;
             xsi:schemaLocation=&quot;http://wadl.dev.java.net/2009/02 http://apigee.com/schemas/wadl-schema.xsd http://api.apigee.com/wadl/2010/07/ http://apigee.com/schemas/apigee-wadl-extensions.xsd&quot;&gt;

    &lt;resources base=&quot;http://api-playground.appspot.com&quot;&gt;

        &lt;resource path=&quot;/time&quot;&gt;
            &lt;method id=&quot;getTime&quot; name=&quot;GET&quot; apigee:displayName=&quot;Get time since epoch&quot;&gt;
                &lt;apigee:tags&gt;
                    &lt;apigee:tag primary=&quot;true&quot;&gt;Time&lt;/apigee:tag&gt;
                &lt;/apigee:tags&gt;            
                &lt;apigee:authentication required=&quot;false&quot;/&gt;
                &lt;apigee:example url=&quot;/time&quot;/&gt;
            &lt;/method&gt;
        &lt;/resource&gt;

    &lt;/resources&gt;

&lt;/application&gt;
</code></pre></noscript></div>

<p>Create a new console on <a href="https://apigee.com/togo">Apigee Console To-Go</a>, upload the WADL file for my playground API.</p>

<p>That’s all I need to do. Now the console is ready and anyone can try my time API on the console. This is a snapshot of API request-response:</p>

<iframe src="https://snap.apigee.com/NRNmNb" width="800" height="300" frameborder="0" scrolling="no"></iframe>

<h2 id="usergrid">Usergrid</h2>

<p>A cloud-based <strong>data service</strong> for application developer, especially for mobile application developer. It provides a core set of <em>commonly used social media application objects</em>, including a rich user model, as well as the ability to create new objects. </p>

<p>REST API is provided, with data model in JSON.  </p>

<p>Features includes:</p>

<ul>
  <li>
    <p><em>User model</em>. Organize users into groups, teams or other structures. User authentication via Facebook, Twitter or other OAuth services. User profile synchronization.</p>
  </li>
  <li>
    <p><em>Collections</em>. Any type of application data in JSON. Data sharing between users and applications.</p>
  </li>
  <li>
    <p><em>Messages and activities</em>. Automates user interaction e.g. status updates, check-ins, comments in the form of activity streams. Support messaging (application internal) and notifications by delivering activities to connected users.</p>
  </li>
  <li>
    <p><em>Data analytics</em>. Log events generated by application. Store, search and analyze at any level of scale.</p>
  </li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xperia U 上手]]></title>
    <link href="http://aleung.github.com/blog/2012/07/22/xperia-u/"/>
    <updated>2012-07-22T18:22:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/07/22/xperia-u</id>
    <content type="html"><![CDATA[<p><img src="http://aleung.github.com/blog/attachments/2012/7/xperia-u.png" /></p>

<p><a href="http://en.wikipedia.org/wiki/Nexus_One">Nexus One</a> 手机用了两年多，升过几次系统，到现在用起来还是挺满意，但唯一的问题是内部存储(ROM)太小了，只有512M，留给安装应用的空间不足200M，而现在的应用又越来越大，已经到了当想装新应用必须先卸载其他一些的地步了。尝试过A2SD，效果不大理想，卡顿感比较明显，也可能因为我的TF卡速度不够高。</p>

<p>现在换的这个 <a href="http://www.sonymobile.com/global-en/products/phones/xperia-u/">Sony Xperia U</a> 属于 <a href="http://www.xperiablog.net/2012/03/07/xperia-nxt-specifications-compared-%E2%80%93-xperia-p-vs-xperia-s-vs-xperia-u/">Xperia NXT</a> 系列，称为Sony下一代智能手机，包括 Xperia S, Xperia P 和 Xperia U，档次由高至低。Xperia U 在配置上其实跟 Nexus One 变化不算大（<a href="http://geekaphone.com/compare/Sony-Xperia-U-vs-HTC-Nexus-One">对比</a>），主要区别是CPU双核(频率相同)，内部存储容量4G，而其他的如屏幕之类都不相上下。不过，两个产品发布时间差了2年，Nexus One在当年算是旗舰级别，而现在Xperia U只是中端机型，在现在的手机大混战中一点都不起眼。这也正符合我目前的需要，相当于一个内存升级版的Nexus One。之前考虑过人称Google三儿子的Galaxy Nexus，样样都满意，不过有些特性我倒用不着，例如4.6寸大屏幕。</p>

<p>玩了几天，跟我的期望比较一致，总体满意。有些经验记录下来。</p>

<h2 id="section">刷机</h2>

<p>参考前一篇 <a href="http://aleung.github.com/blog/2012/07/21/flashing-xperia-u/">Xperia U 刷机</a>。</p>

<h2 id="section-1">透明发光条</h2>

<p>在屏幕下方软按键处有一条称为 illuminating transparent band 的发光条，晚上环境光线暗的时候，那条光带有点刺眼，干脆不要亮好了，找到一个应用 <a href="https://play.google.com/store/apps/details?id=com.haxor">Screen Filter</a> 可以将soft-key backlight关闭。另外，在 Google Play 搜索“illumination bar”可以找到一些应用能够将这个发光条用作未接来电、未读短信、邮件的提醒灯。</p>

<h2 id="usb">USB连接电脑</h2>

<p>Xperia NXT 系列的USB连接采用<a href="http://en.wikipedia.org/wiki/Media_Transfer_Protocol">MTP</a> (Media Transfer Protocol) 模式，而不是通常的MSC(Mass Storage)模式。在Windows里，USB连上后，会显示成一个没有盘符的设备，可以在explorer中访问，但在Mac OS X中，就根本看不到。XDA上有人做了个应用<a href="http://forum.xda-developers.com/showthread.php?t=1606940">SDCARD Mounter</a>，装在手机上后（需要root），能够将Xperia S/U/P的内部存储空间用MSC模式mount起来，这样在电脑上就能够像U盘一样访问了。</p>

<p>如果手机没有root，那么Mac OS X还可以安装<a href="http://www.android.com/filetransfer/">Android File Transfer</a>来访问手机存储，不过我没有试过是否可行。重要的是，Android File Transfer只能在它的窗口中看到手机的文件，而不是挂载在文件系统上，在finder和shell中都访问不了，这是因为MTP模式下文件系统并不是由电脑端管理，而是在设备端管理。我需要用script来控制传输文件，因此只能用MSC模式。</p>

<h2 id="dlna">DLNA</h2>

<p>用Xperia自带应用播放音乐、视频或者浏览照片时，菜单里有一个选项叫做”Play on device”，说明是 find &amp; connect to DLNA device。</p>

<p>DLNA是什么呢，上网查了一通，原来这是一个类似Apple的AirPlay的规范，通过网络在设备之间共享数字媒体播放。准确的说，<a href="http://en.wikipedia.org/wiki/Digital_Living_Network_Alliance">DLNA</a>的功能集比AirPlay要广很多，定义了 media server，media player，media renderer，media controller 等多种设备（实际上一种设备可以身兼多职），现在应用广泛的有两种模式：</p>

<ul>
  <li>
    <p><strong>播放媒体服务器上的音频视频（pull）</strong>。在一个设备(media player)上，浏览和播放另外一台设备(media server)上的资源。这时，用户是在播放设备上进行操作的，例如在手机上播放电脑里保存的视频。</p>
  </li>
  <li>
    <p><strong>将媒体推送到另外一个设备远程播放（push）</strong>。如将在手机上正在看的视频推送到大电视上播放，这时手机是media controller，电视机是media renderer，media server看情况，可能是手机也可能是其他设备，要看媒体源在哪里。跟另一种模式的区别是，用户并不是在播放设备上进行操作的，手上的设备就像一个遥控器。这也是AirPlay能做的事情。</p>
  </li>
</ul>

<p>Xperia U 的 play on device 就是push模式。但我家里没有支持DLNA的电视机，有没有办法推送到电脑，用电脑的显示器来播放呢？如果是Win7就很好办，Win7带的Media Player内置支持DLNA，将媒体库菜单里的“允许远程控制我的播放器”选中就可以了。但是我的电脑用的是Mac OS X，这种办法走不通。后来发现大名鼎鼎的<a href="http://xbmc.org/">XBMC</a>也支持 DLNA renderer 功能，在network setting里面将 Allow control of XBMC via UPnP 选上，手机 play on device 菜单里果然就出现了XBMC可供选择。另外，还惊喜的发现 XBMC 还有 Allow XBMC to receive AirPlay content 选项，测试过能够将iPad的视频推送到XBMC中播放。太好了，那就可以用 Thunderbolt Display 来看了。</p>

<p>Xperia U 还可以充当 DLNA media server，试过在电脑上用<a href="http://www.videolan.org/vlc/">VLC</a>可以浏览手机上的所有视频、音乐、照片。需要在手机的 Connected devices 应用中enable。</p>

<h3 id="reference">Reference:</h3>

<ul>
  <li><a href="http://aleung.github.com/blog/2010/05/11/Nexus-One-/">Nexus One 到手，以及刷机过程</a></li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xperia U 刷机]]></title>
    <link href="http://aleung.github.com/blog/2012/07/21/flashing-xperia-u/"/>
    <updated>2012-07-21T23:20:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/07/21/flashing-xperia-u</id>
    <content type="html"><![CDATA[<p>昨天中午拿到国行 <a href="http://www.sonymobile.com/global-en/products/phones/xperia-u/">Sony Xperia U</a> (ST25i) 手机，开机试了一下，索尼(原来的索尼爱立信)在Android 2.3基础上的定制系统做得还可以，但大陆行货里好多功能都被阉割得不成样子。Google系列的任何东西都去掉了就不用说了，很奇怪的是居然系统里没有自带任何应用市场，国内的山寨市场也没有。可以想象一个不熟悉IT的用户买到手机后就会局限在预装的那几个应用，连升级都没有途径。比较一下SonyMobile英文与中文网站对这款手机的介绍，就会发现中文产品介绍缩水不少，好多卖点都没有了。</p>

<p>这样的智能手机简直就是残废，于是下班后就开始研究怎么刷机。先是在国内的一些论坛上搜索，但国内论坛真是很没有营养，里面的信息的价值很低。Android hacker的大本营在XDA，相关问题还是要到<a href="http://www.xda-developers.com/">XDA论坛</a>找靠谱。</p>

<p>关于Xperia系列刷机需要了解的基础知识，这篇 <a href="http://forum.xda-developers.com/showthread.php?t=1526866">All that u need to know before u begin</a> 讲得比较清楚。</p>

<p>无论要刷什么，前提条件是先将 bootloader 解锁。关于解锁的教程很多，SonyMobile网站上就有详细步骤，XDA上的 <a href="http://forum.xda-developers.com/showthread.php?t=1527159">Xperia S/P/U/Sola Bootloader Unlocking &amp; Relocking</a> 附带了所需工具的下载。还有一个国产软件，号称是一键自动解锁。</p>

<p>但是，就在第一步，将手机boot到fastboot模式，就花了我好几个小时。按教程，手机在关机状态按着音量+键的同时将USB连接上电脑，就会进入fastboot模式，并且亮起蓝灯。但是无论我怎么反复重试，手机都不会亮起蓝灯，电脑上弹出对话框提示安装驱动程序，但当我选择操作时它又说USB设备已经断开，显示这样的错误信息：s1boot fastboot device unplugged。网上搜索，有人说是驱动没有装好的原因，最后还是从XDA里找到了<a href="http://forum.xda-developers.com/showthread.php?t=1554632">解决方案</a>。原来，Xperia手机在进入fastboot模式时，会检测电脑是否已经装上了正确的驱动程序，如果没有，就会退出fastboot模式。而电脑端刚刚提示用户安装驱动，就发现手机已经关闭了连接，就取消了驱动的安装。这种问题可以用来做经典反面案例了。XDA帖子里的解决方法还是要拼手快：预先打开设备管理器，一插上手机后，里面会出现s1boot这个设备，赶紧鼠标右键选择升级驱动，升级驱动的对话框打开后，即使设备断开了还是可以继续进行驱动程序的安装。终于看到传说中的蓝灯了，原来是在下面透明发光条发出很亮的蓝光，我之前还一直以为是右上角摄像头旁边的小灯。</p>

<p>接下来就非常顺利了，解锁bootloader后，用fastboot安装了ROM和Kernel。我都没有另外用其他工具了，感觉fastboot用起来就很简单，很多人不喜欢可能是因为命令行操作吧。关于fastboot使用，推荐看cyanogenmod的wiki里的<a href="http://wiki.cyanogenmod.com/wiki/Fastboot">介绍</a>。</p>

<p>我刷的ROM是<a href="http://forum.xda-developers.com/showthread.php?t=1684062">KA02 Xperia SSpeed</a>， 还是Android 2.3.7，Sony还没有为Xperia U 提供Android 4.0 ICS。Kernel是<a href="http://forum.xda-developers.com/showthread.php?t=1688147">Advanced Stock Kernel</a>。刷完开机，见到熟悉Google账号绑定，然后Gmail、通信录、日历同步、Google Play都回来了。Root也有了，收工。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[《简约至上》读书笔记]]></title>
    <link href="http://aleung.github.com/blog/2012/07/14/simple-first/"/>
    <updated>2012-07-14T10:43:00+08:00</updated>
    <id>http://aleung.github.com/blog/2012/07/14/simple-first</id>
    <content type="html"><![CDATA[<p><a href="http://book.douban.com/subject/5394309/">简约至上</a>，原作名为 Simple and Usable Web,Mobile,and Interaction Design，不错的关于交互设计的书籍。</p>

<iframe id="xmindshare_embedviewer" src="http://www.xmind.net/share/_embed/aleung/simple-first/" width="900px" height="300px" frameborder="0" scrolling="no"></iframe>
]]></content>
  </entry>
  
</feed>

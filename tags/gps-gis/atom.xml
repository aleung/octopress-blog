<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: GPS_GIS | Good good study, day day up]]></title>
  <link href="http://aleung.github.io/blog/tags/gps-gis/atom.xml" rel="self"/>
  <link href="http://aleung.github.io/blog/"/>
  <updated>2015-10-06T01:05:58+08:00</updated>
  <id>http://aleung.github.io/blog/</id>
  <author>
    <name><![CDATA[Leo Liang]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[中國電子地圖偏移]]></title>
    <link href="http://aleung.github.io/blog/2014/04/03/zhong-guo-di-tu-pian-yi/"/>
    <updated>2014-04-03T07:43:45+08:00</updated>
    <id>http://aleung.github.io/blog/2014/04/03/zhong-guo-di-tu-pian-yi</id>
    <content type="html"><![CDATA[<p>幾年前我寫過對Google中國地圖偏移規律的分析(<a href="/2009/12/26/Google-China-Map-offset-1/">1</a>)(<a href="/2009/12/27/Google-China-Map-offset-2/">2</a>)，根據抓取到的偏移量數據，大概看出呈現了<code>sin(a)+sin(3a)</code>這樣的函數曲線規律，並且這個函數以不同頻率和幅度疊加了兩次。當時我推導出函數及其係數，利用它去校正偏移，在百公里範圍的區域內已經非常理想，但是在全國大範圍的不同區域，係數需要有點不同，也就是擬合函數還是差了一些低頻率的細節。不過當時的分析細節我也不敢在博客裏面寫，後來我也沒有再搞地圖方面的應用開發了，就把這個放下。</p>

<p>實際上這個地圖偏移並不是Google自己搞的算法，而是國家測繪局以立法的形式統一要求加的，稱為地形图非线性保密处理，所有從事國內電子地圖的廠商應該都得到了這個算法，實際上並起不到什麼所謂保護國家安全和國家利益的作用（保護行業壟斷者利益倒是真的），但是這個地圖偏移對地理信息處理和GPS技術的民用化起到了巨大的阻礙作用，近年各種與地理位置相關的應用如雨後春筍般湧現，但都為中國地圖的偏移而頭痛不已，後來由於下面提到的算法的流傳，問題得以解決，但增加很多不必要的複雜性和浪費開發、數據處理的人力。在我看來，這個地圖非線性加密處理在地理信息領域就像GFW在互聯網信息領域一樣，浪費了大量社會財富來對技術發展與應用進行封鎖。<a href="http://baike.baidu.com/view/2356807.htm#2_2">李成名</a>，你真的成名了。</p>

<p>感謝Internet，感謝open source，現在這個偏移算法在網上已經可以輕松找到了。</p>

<p>網上流傳的原始算法是<a href="http://emq.googlecode.com/svn/emq/src/Algorithm/Coords/Converter.java">這個Java文件</a>，然後有人整理過代碼，接力開發出多種語言版本。在『A Fork of Stuffs』博客裏，<a href="http://blog.csdn.net/coolypf/article/details/8686588">地球坐标系 (WGS-84) 到火星坐标系 (GCJ-02) 的转换算法</a>給出了C#實現，這個博客另外一篇<a href="http://blog.csdn.net/coolypf/article/details/8569813">火星坐标系 (GCJ-02) 与百度坐标系 (BD-09) 的转换算法</a>也很有用。而使用比較方便應該是下面的github代碼庫：</p>

<ul>
  <li><a href="https://github.com/googollee/eviltransform">googollee/eviltransform</a>: C, go, JavaScript, php語言版本</li>
  <li><a href="https://github.com/Leask/EvilTransform">Leask/EvilTransform</a>: Java和C#語言版本，似乎就是將前面介紹的代碼收集到github裏面，沒有改動。</li>
</ul>

<p>另外，github裏還有一個項目 <a href="https://github.com/fourcels/lbs">fourcels/lbs</a> 是用查表法來糾偏的，裏面的偏移數據（共9M）說不定就是早期從Google地圖服務上抓下來的。但現在有了算法，查表法的價值就不大了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[复旦学生黄山被困事件的感想]]></title>
    <link href="http://aleung.github.io/blog/2010/12/23/Fudan-student-huangshan-trapped-events-of-feeling/"/>
    <updated>2010-12-23T19:08:00+08:00</updated>
    <id>http://aleung.github.io/blog/2010/12/23/Fudan-student-huangshan-trapped-events-of-feeling</id>
    <content type="html"><![CDATA[<p>很久没有玩户外了，对相关的新闻不再关注。复旦大学生黄山遇险的事情网上流传很广，但我一直也没有点进去看过。今天在Google Reader上看到朋友转发的文章，终于知道是怎么回事了。</p>

<p>关于救援技术和道德层面的东西就不说了。磨房有个<a href="http://www.doyouhike.net/forum/shrescue/476142,0,0,1.html">帖子</a>，从队伍被困就开始讨论了，可以从中了解一些细节。说说我的几个感想：</p>

<ul>
  <li>户外救援这事情上，警方的技术水平和装备水平都非常差。对于他们，应该少些政治学习，多些专业训练；少些吃喝嫖赌，买些专业装备。但明显他们是做不到的，所以还是别指望他们了。</li>
  <li>这类事情由警方（或者政府部门）包办并不是好办法，很多民间的户外爱好者和从业人员组织起来都能够做得比他们好。但是政府视民间组织为洪水猛兽，生怕造他们的反。</li>
  <li>被困队伍虽然说GPS落水怀疑故障，但他们其实还是定位出自己坐标的。如果配合小比例尺地图，无论是自救还是他救都会比较容易。但是我们在自欺欺人的将这个当国家机密。网上倒是有驴友根据Google Earth卫星图和美国公开的SRTM数据制作等高线图辅助分析了。 （BTW，在<a href="http://goo.gl/maps/bGmE">maps.google.com</a>和<a href="http://ditu.google.cn/maps?f=q&amp;source=s_q&amp;hl=zh-CN&amp;geocode=&amp;q=N30+07.663+E118+11.892&amp;sll=35.86166,104.195397&amp;sspn=69.767299,135.087891&amp;ie=UTF8&amp;ll=30.126087,118.203707&amp;spn=0.037712,0.065961&amp;t=h&amp;z=15&amp;brcurrent=3,0x3435b9bdd80e3bef:0x40d4f885edcbae5e,0,0x3435c43623481ccb:0x4f313f2031517549%3B5,0,0">ditu.google.cn</a>上分别输入这个坐标：N30 07.663 E118 11.892，仔细看看，标出的地点是不同的，偏差五六百米。只不过恰好在同一条沟里）</li>
</ul>

<p>贴两张Google Maps的截图，绿色箭头处是被困地点。</p>

<p><a href="http://www.flickr.com/photos/leoliang/5284797781/"><img src="http://farm6.static.flickr.com/5006/5284797781_e71c32744a_b.jpg" alt="fudan_huangshan_1" /></a></p>

<p>这张从另外一个角度看的，放大一些，都勉强可以看到山谷里面的大石了。不过这种模拟地势的精度不高，一些陡峭的局部地形都被柔和了，实际会险要得多。不要看着这张图就骂那些学生，以为小跑都可以下山。</p>

<p><a href="http://www.flickr.com/photos/leoliang/5284797851/"><img src="http://farm6.static.flickr.com/5123/5284797851_dec842f909_b.jpg" alt="fudan_huangshan_2" /></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Amazing, I got the geocoin which was sent to me from Italy two years ago!]]></title>
    <link href="http://aleung.github.io/blog/2010/06/28/Amazing-I-got-the-geocoin-which-was-sent-to-me-from-Italy-two-years-ago-/"/>
    <updated>2010-06-28T16:35:00+08:00</updated>
    <id>http://aleung.github.io/blog/2010/06/28/Amazing-I-got-the-geocoin-which-was-sent-to-me-from-Italy-two-years-ago-</id>
    <content type="html"><![CDATA[<p><a href="http://www.flickr.com/photos/leoliang/4741853682/"><img src="http://farm5.static.flickr.com/4121/4741853682_e9e93e2010.jpg" alt="Geocoin ALEUNG 1" /></a></p>

<p>This picture was taken at 18:44 18-Jun-2010, when I picked up the geocoin <a href="http://www.geocaching.com/track/details.aspx?id=1007428">ALEUNG 1</a> from the cache <a href="http://www.geocaching.com/seek/cache_details.aspx?guid=f4f03572-94c5-440a-ae7e-ce1f755a069b">Golden Triangle</a>. The coin has traveled for two and a half years and over 21 thousand kilometers fromVeneto, Italy before it came to Guangzhou, China.</p>

<p>If you don’t know what is Geocaching, please refer to the definition on <a href="http://en.wikipedia.org/wiki/Geocaching">Wikipedia</a>. In simple saying, it’s a game that someone hide something (a cache) and publish the coordinate (latitude and longitude) on Internet and then other players seek it with help of a GPS receiver. <a href="http://en.wikipedia.org/wiki/Geocoin">Geocoin</a> is a special kind of coin each has an unique number that can be traced on geocaching website. Geocaching players pick up a coin from one cache and drop it into another cache, so that the coin can travel from cache to cache, even around the world.</p>

<p>The story began from Oct 2006, Italian geocacher <a href="http://www.geocaching.com/profile/?guid=b160e421-bca1-4b08-9c48-7944b4f019dc">i5fzi</a> came to Guangzhou for the Canton Fair. He contacted me on <a href="http://www.geocaching.com/">geocaching.com</a>.He didn’t know me before, but I was almost the only cacher in Guangzhou at that time. So it was geocaching that make us know each other. He kindly invited me for dinner and I suggested him some caches to find.</p>

<p>After i5fzi came back to Italy, he sent out several geocoins as present to me and Cherrie, who was his translator in Guangzhou. The goal of these coins are to reach my caches in Guangzhou. But unfortunately most of the geocoins were missed in there trip, this one I got is the only survival – I am so lucky to get it.</p>

<p>From this <a href="http://www.geocaching.com/track/map_gm.aspx?ID=1007428">map</a> you can see where the coin has been in. It visited some places in Europe then flied to HongKong, and then held by AirQ for a long time, until it was put in Guangzhou. I also thank AirQ, if AirQ didn’t hold and take it to Guangzhou, I guess this coin would have been lost as its friends. The last hotel the coin slept was KowloonW’s <a href="http://www.geocaching.com/seek/cache_details.aspx?guid=f4f03572-94c5-440a-ae7e-ce1f755a069b">Golden Triangle</a>, but it isn’t shown on the map because not recorded on the website. KowloonW was very nice to keep the coin to avoid loss until I have time to fetch it.</p>

<p>Geocaching is so an amazing game. Thank you, all my friends in this game!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Google中国地图偏移 (续)]]></title>
    <link href="http://aleung.github.io/blog/2009/12/27/Google-China-Map-offset-2/"/>
    <updated>2009-12-27T22:04:00+08:00</updated>
    <id>http://aleung.github.io/blog/2009/12/27/Google-China-Map-offset-2</id>
    <content type="html"><![CDATA[<p>接着<a href="/2009/12/26/Google-China-Map-offset-1/">昨天的分析</a>。</p>

<p>已经发现在纬线上的偏移值呈现出明显的规律性，这个规律不难拟合出来。利用拟合出来的函数将这个高频扰动抵消之后，得到了这样的曲线：</p>

<p><img src="/attachments/2009/12/4382498800_1bc9e586dd_o.jpg" alt="" /></p>

<p>看起来相当完美。那在看看将它应用到大尺度上效果如何：</p>

<p><img src="/attachments/2009/12/4381740587_73cd1113fd_o.jpg" alt="" /></p>

<p>有微小的抖动，看来参数细节还需要微调一下，不过要求不高的话其实已经可以接受了。</p>

<p>接下来，在这张图上又发现了规律…… 嗯，我不能继续写下去了。</p>

<p>其实对于离线应用，进一步的分析不做也没有关系了，并不需要将整个函数拟合出来，剩余的工作可以通过查表法来做，然后插值再加回高频扰动。因为知道了高频扰动的函数后，就能够用较低的采样频率来记录偏移量，即使将整个表放内存里，占用的空间大小也可以接受。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Google中国地图偏移]]></title>
    <link href="http://aleung.github.io/blog/2009/12/26/Google-China-Map-offset-1/"/>
    <updated>2009-12-26T21:37:00+08:00</updated>
    <id>http://aleung.github.io/blog/2009/12/26/Google-China-Map-offset-1</id>
    <content type="html"><![CDATA[<p>以前我一直以为Google手机地图是在客户端程序内置有矫偏算法的，看了dongmeng110的blog（已被关闭）才知道Google地图偏移其实是有接口可以取到的。给定经纬度坐标，返回地图tile的偏移像素值。
<code>http://ditu.google.cn/maps/vp?spn=0.0,0.0&amp;amp;z=18&amp;amp;vp=39.111195,117.148067</code> （已失效）。</p>

<p>没想到居然就是直接从服务器取，这样所有的偏移量其实都是公开的了。</p>

<p>接下来，我对偏移数据做了一些分析。纵坐标是18级地图的偏移量。</p>

<p>首先是较小尺度，在经纬度1度的范围内每0.01度取得一个偏移值。</p>

<p>图一：纬度不变，经度1度变化范围内，偏移量的变化（横坐标数字为经度0.01度）</p>

<p><img src="/attachments/2009/12/4382500790_05a7a3af13_o.jpg" alt="" /></p>

<p>图二，与图一相同的数据，可以看出偏移在平面上的变化</p>

<p><img src="/attachments/2009/12/4382501234_2a060a3355_o.jpg" alt="" /></p>

<p>图三，经度不变，纬度1度变化范围内，偏移量的变化（横坐标数字为纬度0.01度）。可见偏移量变化不如经度变化时大。</p>

<p><img src="/attachments/2009/12/4382501616_0902aeee3e_o.jpg" alt="" /></p>

<p>图四，与图三相同的数据，可以看出偏移在平面上的变化</p>

<p><img src="/attachments/2009/12/4382501968_d960178154_o.jpg" alt="" /></p>

<p>图五，经度纬度均1度范围内，偏移在平面上的变化。其实是图二与图四“相乘”的结果。</p>

<p><img src="/attachments/2009/12/4381741057_b10a5de8ca_o.jpg" alt="" /></p>

<p>接下来从大尺度上看看。</p>

<p>图六，北纬40度的纬线上偏移值变化图，横坐标为经度。看得出以经度1度为周期呈现出一定的规律性，在y向偏移量上特别明显。</p>

<p><img src="/attachments/2009/12/4382499286_a837b8022d_o.jpg" alt="" /></p>

<p>图七，东经116度的经线上偏移值变化图，横坐标为纬度。这个就没有奇怪的小波动了，而且x向偏移似乎可以非常理想的用二次曲线来拟合。</p>

<p><img src="/attachments/2009/12/4381742115_a15b5e01c5_o.jpg" alt="" /></p>

<p>图八，刚才在图六中发现纬线上的偏移值呈现出规律性，这里放大来看看。很明显是以1度为周期的。</p>

<p><img src="/attachments/2009/12/4382498276_2952ffa74c_o.jpg" alt="" /></p>

<p>暂无结论。请看<a href="/2009/12/27/Google-China-Map-offset-2/">续篇</a>。</p>

]]></content>
  </entry>
  
</feed>

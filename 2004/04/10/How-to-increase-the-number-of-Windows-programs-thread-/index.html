
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>如何增加windows程序的线程数量? - Good good study, day day up</title>
  <meta name="author" content="Leo Liang">

  
  <meta name="description" content="编写测试程序, 发现超过1000个线程, 程序执行就会出现内存错误. 原来我还以为是windows对线程数量有限制, 查资料才知道支持线程多少并不是操作系统决定的, 而是与程序的堆栈空间大小有关. 在VC中, 修改Project Setting - Link - Stack allocation &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://aleung.github.com/blog/2004/04/10/How-to-increase-the-number-of-Windows-programs-thread-/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="/blog/javascripts/ender.js"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/GoodGoodStudyDayDayUp" rel="alternate" title="Good good study, day day up" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Good good study, day day up</a></h1>
  
    <h2>aleung的学习笔记, aleung的idea</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/GoodGoodStudyDayDayUp" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:aleung.github.com/blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">如何增加windows程序的线程数量?</h1>
    
    
      <p class="meta">
        








  


<time datetime="2004-04-10T06:10:00+08:00" pubdate data-updated="true">2004-04-10</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/softwaredev/'>SoftwareDev</a>
  
</span>


        
      </p>
    
  </header>


<div class="entry-content"><p>编写测试程序, 发现超过1000个线程, 程序执行就会出现内存错误. 原来我还以为是windows对线程数量有限制, 查资料才知道支持线程多少并不是操作系统决定的, 而是与程序的堆栈空间大小有关.</p>

<p>在VC中, 修改Project Setting - Link - Stack allocation - Reserve, 缺省为1M(0x100000), 将这个数值降低, 也就是减少每个线程的栈空间大小, 就可以增加线程数量. 这是因为用户地址空间总共是2GB, 线程保留栈空间大小乘以线程数量不能大于2GB.</p>

<p>因为上下文切换的开销, 线程过多效率会降低, 我做这个测试程序就是想知道这个效率曲线到底是怎样的.</p>

<p>以下为网上找到的资料:</p>

<p>I just found this under CreateThread() in MSDN:  </p>

<p>The number of threads a process can create is limited by the available virtual memory. By default, every thread has one megabyte of stack space. Therefore, you can create at most 2028 threads. If you reduce the default stack size, you can create more threads. However, your application will have better performance if you create one thread per processor and build queues of requests for which the application maintains the context information. A thread would process all requests in a queue before processing requests in the next queue.  </p>

<p>So the number of threads you can create is capped by the 2 GB user address space available to your process.  </p>

<p>So you have a few choices, as I see it:  </p>

<p>1) Run multiple copies of your server at once and coordinate between them. You will need endless amounts of swap space.<br />
2) Reduce the amount of stack used per thread (lowering from 1 Mb to 100Kb should get you 40,000 threads).<br />
3) Re-architect your app to not require one thread per connection. Have each thread monitor many connections using (for example) a select() call.</p>
</div>


  <footer>
    <p class="meta">
    <!--
      
  

<span class="byline author vcard">Posted by <span class="fn">Leo Liang</span></span>

      








  


<time datetime="2004-04-10T06:10:00+08:00" pubdate data-updated="true">2004-04-10</time>
      


      

<span class="tags">
  
    <a class='tag' href='/blog/tags/softwaredev/'>SoftwareDev</a>
  
</span>


    -->
    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://aleung.github.com/blog/2004/04/10/How-to-increase-the-number-of-Windows-programs-thread-/" data-via="acette" data-counturl="http://aleung.github.com/blog/2004/04/10/How-to-increase-the-number-of-Windows-programs-thread-/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2004/04/05/Target-plan/" title="Previous Post: 目标，计划">&laquo; 目标，计划</a>
      
      
        <a class="basic-alignment right" href="/blog/2004/04/30/Solve-Xerces-C-XML-parser-EnitiyResolver-doesn-t-work-in-the-problem/" title="Next Post: 解决Xerces-C XML parser中EnitiyResolver不起作用的问题">解决Xerces-C XML parser中EnitiyResolver不起作用的问题 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/06/24/try-octopress-markdown-features/">试验 Octopress 的各种特性</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/09/Some-reading-record/">一些读书记录</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/05/The-programmer-thought-of-uniting-the-reading-notes/">《程序员的思维修炼》读书笔记</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/10/By-mobile-phone-remote-control-Linux-backstage-radio-broadcast-requirements/">用手机遥控Linux后台播放豆瓣电台</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/25/In-the-amazon-bought-the-computer-motherboard-and-summarizes-the-experience-of-fault-return/">在亚马逊买电脑主板，故障退货的经历及总结</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
<a style="font-size: 134%" href="/blog/tags/android/">Android</a>
<a style="font-size: 108%" href="/blog/tags/anti-gfw/">Anti-GFW</a>
<a style="font-size: 70%" href="/blog/tags/appserver/">AppServer</a>
<a style="font-size: 70%" href="/blog/tags/blogging/">Blogging</a>
<a style="font-size: 70%" href="/blog/tags/build/">Build</a>
<a style="font-size: 70%" href="/blog/tags/diy/">DIY</a>
<a style="font-size: 104%" href="/blog/tags/diy/">Diy</a>
<a style="font-size: 70%" href="/blog/tags/excel/">Excel</a>
<a style="font-size: 93%" href="/blog/tags/funny/">Funny</a>
<a style="font-size: 85%" href="/blog/tags/gps/">GPS</a>
<a style="font-size: 139%" href="/blog/tags/gps-gis/">GPS_GIS</a>
<a style="font-size: 70%" href="/blog/tags/geocaching/">Geocaching</a>
<a style="font-size: 70%" href="/blog/tags/http/">HTTP</a>
<a style="font-size: 144%" href="/blog/tags/idea/">Idea</a>
<a style="font-size: 99%" href="/blog/tags/imageprocessing/">ImageProcessing</a>
<a style="font-size: 70%" href="/blog/tags/learning/">Learning</a>
<a style="font-size: 108%" href="/blog/tags/life/">Life</a>
<a style="font-size: 85%" href="/blog/tags/maven/">Maven</a>
<a style="font-size: 146%" href="/blog/tags/misc/">Misc</a>
<a style="font-size: 85%" href="/blog/tags/novel/">Novel</a>
<a style="font-size: 70%" href="/blog/tags/outdoor/">Outdoor</a>
<a style="font-size: 85%" href="/blog/tags/personaldevelopment/">PersonalDevelopment</a>
<a style="font-size: 93%" href="/blog/tags/reading/">Reading</a>
<a style="font-size: 93%" href="/blog/tags/running/">Running</a>
<a style="font-size: 70%" href="/blog/tags/sip/">SIP</a>
<a style="font-size: 142%" href="/blog/tags/software/">Software</a>
<a style="font-size: 160%" href="/blog/tags/softwaredev/">SoftwareDev</a>
<a style="font-size: 99%" href="/blog/tags/sports/">Sports</a>
<a style="font-size: 85%" href="/blog/tags/spring/">Spring</a>
<a style="font-size: 119%" href="/blog/tags/sys-admin/">Sys_Admin</a>
<a style="font-size: 104%" href="/blog/tags/timemanagement/">TimeManagement</a>
<a style="font-size: 85%" href="/blog/tags/weblogic/">WebLogic</a>
<a style="font-size: 70%" href="/blog/tags/backup/">backup</a>
<a style="font-size: 93%" href="/blog/tags/idea/">idea</a>
<a style="font-size: 104%" href="/blog/tags/mobile/">mobile</a>
<a style="font-size: 70%" href="/blog/tags/wallpaper/">wallpaper</a>
<a style="font-size: 70%" href="/blog/tags/书摘/">书摘</a>
<a style="font-size: 70%" href="/blog/tags/交通/">交通</a>
<a style="font-size: 70%" href="/blog/tags/公民与社会/">公民与社会</a>
<a style="font-size: 70%" href="/blog/tags/家电/">家电</a>
<a style="font-size: 70%" href="/blog/tags/建筑/">建筑</a>
<a style="font-size: 70%" href="/blog/tags/文化艺术/">文化艺术</a>
<a style="font-size: 70%" href="/blog/tags/概率/">概率</a>
<a style="font-size: 70%" href="/blog/tags/环保/">环保</a>
<a style="font-size: 70%" href="/blog/tags/统计/">统计</a>
<a style="font-size: 70%" href="/blog/tags/阅读/">阅读</a>

  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Leo Liang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'aleung';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://aleung.github.com/blog/2004/04/10/How-to-increase-the-number-of-Windows-programs-thread-/';
        var disqus_url = 'http://aleung.github.com/blog/2004/04/10/How-to-increase-the-number-of-Windows-programs-thread-/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>


<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Good good study, day day up</title>
  <meta name="author" content="Leo Liang">

  
  <meta name="description" content="没有想到，欧洲航天局网站上的一张卫星照片引起了国内沸沸扬扬的讨论，而且讨论还大有向民族精神升级的趋势，真让人哭笑不得。 由于个人爱好，曾经专门找过一些有关卫星遥感的资料来看，卫星照片也看过一些。且不论卫星照片上可见到长城与太空飞船中肉眼是否可见长城有些什么联系， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://aleung.github.com/blog/blog/page/45/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="/blog/javascripts/ender.js"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/GoodGoodStudyDayDayUp" rel="alternate" title="Good good study, day day up" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2827715-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Good good study, day day up</a></h1>
  
    <h2>aleung的学习笔记, aleung的idea</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/GoodGoodStudyDayDayUp" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:aleung.github.com/blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2004/05/20/The-European-space-agency-mistakes-In-the-photo-is-the-Great-Wall-/">欧洲航天局的低级错误？照片中的是长城吗？</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2004-05-20T06:50:00+08:00" pubdate data-updated="true">2004-05-20</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/gps-gis/'>GPS_GIS</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p>没有想到，欧洲航天局网站上的一张卫星照片引起了国内沸沸扬扬的讨论，而且讨论还大有向民族精神升级的趋势，真让人哭笑不得。</p>

<p>由于个人爱好，曾经专门找过一些有关卫星遥感的资料来看，卫星照片也看过一些。且不论卫星照片上可见到长城与太空飞船中肉眼是否可见长城有些什么联系，至少我认为欧洲航天局公布的这照片上的根本不是长城。</p>

<p>先来看看欧洲航天局公布的照片吧：<a href="http://esamultimedia.esa.int/images/Proba/cina.jpg">（照片很大，请在新窗口中打开）http://esamultimedia.esa.int/images/Proba/cina.jpg</a> 照片右上角蜿蜒的白线就是被认为是长城，左下角很粗的白线是河流。</p>

<p>在判读卫片、航片时，立体感不是那么直观的，很容易把山脊当成了山谷，山谷当成了山脊，因为都是明暗交界线，不知道阳光方向就很难断定那儿高一些。判断的一个比较有效的方法，就是从河流看起，有河流的地方必然是山谷，两边的是山脊，山谷和山脊是交替的。</p>

<p>原图为了突出右上角，将其余部分增加了亮度，为了分析照片，我用photoshop把图象做了还原处理。<a href="http://sunnyday.cn2k.net/photo/cina_edited.jpg">http://sunnyday.cn2k.net/photo/cina_edited.jpg</a></p>

<p>从图的左下角可以看到一条比较明显的支流，左边又是露出一部分的大河，倚靠左边的这部分图象，就可以找出山脊，并且判断出当时的阳光是从图的右下方向照射过来的。依次向右看过去，就会发现右上角蜿蜒的不是“长城”，而是一条相对细点的河流。从图的右下角看，也能得到这样的结论。</p>

<p>另一方面，在卫星照片中，河谷一般是比山脊明显的，因为山脊通常是较细的线，而河谷由于冲积的原因，比较宽阔。村镇建筑物一般也分布在河谷附近。在图的右上角贴近照片边缘处就可以看到一个小建筑群。</p>

<p>虽然照片没有给出比例尺，但是从图象左下部分很明显的建筑物和公路，就可以对图象的比例有个大概的观念了。很明显，右上角的不可能是长城，太宽了。</p>

<p>这些都是从卫片的判读来认定图上的不是长城。其实要做更科学可靠的判读也不难，只要欧洲航天局给出这张图的坐标范围就行了。根据坐标，将图象与SRTM数字高程模型结合，在电脑中就可以绘制出三维立体图象，哪儿高哪儿低一目了然。</p>

<p>只能说欧洲航天局对这张图的判读过于草率了，居然犯了如此低级的错误。</p>

<p>BTW, 再看看这里的讨论和卫星照片，13m分辨率的，你能识别出司马台长城吗？如果看不出，我可以给一点tips：左下角的水平山脊就是司马台所在的山脊，黑色的一小块是个湖，如果我没有记错，上面有道铁索桥的。</p>

<p><a href="http://www.lvye.org/modules/lvyebb/viewtopic.php?view=1&amp;post_id=743913">http://www.lvye.org/modules/lvyebb/viewtopic.php?view=1&amp;post_id=743913</a><br />
<a href="http://www.smth.org/bbscon.php?bid=332&amp;id=26741&amp;ap=512">http://www.smth.org/bbscon.php?bid=332&amp;id=26741&amp;ap=512</a></p>

<p>2004-5-21补充：</p>

<p>卫星照片的范围居然正好是北京的白河岩场，攀岩的人常玩的地方。看看<a href="http://my.ziqu.com/bbs/665078/messages/2085.html">这个帖子</a>里面的卫星照片，立体感更强了，红色轨迹的地方就是欧洲空间局照片的左下角位置。<a href="http://www.lvye.org/modules/lvyebb/viewtopic.php?post_id=803480">这里</a>有该地区的等高线地图，看图的右上角位置。</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2004/05/20/The-European-space-agency-mistakes-In-the-photo-is-the-Great-Wall-/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2004/05/10/Your-lights-on-/">你的灯亮着吗？</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2004-05-10T03:14:00+08:00" pubdate data-updated="true">2004-05-10</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/idea/'>Idea</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p>同事刚买了几本书，包括了《你的灯亮着吗》。马上拿过来读，书很薄，字很疏，一个来小时就读完了。</p>

<p>看完后有点失望，也许是看书评后期望太高，也许是我并不适合读这样的书，不懂从中领悟些什么。</p>

<p>翻到最后一页，才发现译者在译后记里面已经把这本书的中心思想全归纳出来了。我觉得比较有共鸣的是几点：</p>

<ul>
  <li>意识到问题的存在，与熟视无睹做斗争</li>
  <li>想想什么才是真正的问题？问题的根源在哪里？</li>
  <li>想想这是谁的问题？谁是应该解决问题的人？</li>
</ul>
</div>
  
  
  
    <footer>
        <a href="/blog/2004/05/10/Your-lights-on-/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2004/04/30/Promising-subversion/">前景光明的subversion</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2004-04-30T23:47:00+08:00" pubdate data-updated="true">2004-04-30</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/softwaredev/'>SoftwareDev</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://subversion.tigris.org/">Subversion</a>这个以替代CVS为目标的版本管理工具，看来已经开始获得广泛支持了。经历了4年开发，大概1个月一次小版本发布，今年年初终于发布了version 1.0 release，开发过程平稳而谨慎。我去年曾经试用过一个interim release版本，作为本地个人使用的版本管理工具，已经感觉相当满意，基本可替代CVS。现在release版本发行后，更是在网上看到一些人说打算从CVS迁移到SVN了。在网上可以找到一些达到实用阶段的兼容subversion的软件工具、plugin，从另一个侧面也反映出subversion正在一步步迈向自己的目标。</p>

<p>以前公司的开发团队使用CVS，配合使用<a href="http://www.cvstrac.org/">CVStrac</a>，对于这样的搭配我感到比较满意。CVStrac作为轻量级的issue tracking工具，确实做得很到位，issue/bug record、CVS track-in record和wiki的无缝整合，构成了简单而实用的web base软件项目管理系统，对于小型项目非常合适。</p>

<p>现在，与SVN配合的类似工具也有了，<a href="http://www.edgewall.com/products/trac/">Trac</a>，完全就是CVStrac的一个clone，不过是用python开发的，从screenshot上看很漂亮，细节上似乎做得比CVStrac要好。不过现在公司用ClearCase，没有机会试用这些轻量级工具了。我觉得ClearCase的client并不好用，缺乏象cvsweb这样的直观的文件、目录浏览、trac这样的check-in浏览功能。</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2004/04/30/Promising-subversion/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2004/04/30/Solve-Xerces-C-XML-parser-EnitiyResolver-doesn-t-work-in-the-problem/">解决Xerces-C XML parser中EnitiyResolver不起作用的问题</a></h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2004-04-30T01:32:00+08:00" pubdate data-updated="true">2004-04-30</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/softwaredev/'>SoftwareDev</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p>在SAX和DOM两种paser API中，均提供了EntityResolver接口，应用程序可通过实现这个接口的resolveEntity()方法来实现对外部实体访问的控制，例如将对网络URL的访问重定向为对本地文件或者数据库的访问。Xerces软件包提供了例子redirect来演示这个功能。</p>

<p>在我们的程序中，parse VXML文件时需要使用外部的schema，而这些schema又会间接引用其他的schema或者DTD，这些外部实体都是通过URL形式的system id来指定的（基本上都是在<a href="http://www.w3c.org">www.w3c.org</a>上）。考虑到程序运行环境不一定与internet连接，还有远程网络的效率也不高，我们在程序中实现了自己的EntityResolver，把所有对这些schemas、DTDs的访问都截取下来，返回程序中内置的拷贝。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="k">class</span> <span class="nc">DTDResolver</span> <span class="o">:</span> <span class="k">public</span> <span class="n">EntityResolver</span> <span class="p">{</span>
</span><span class="line"><span class="k">public</span><span class="o">:</span>
</span><span class="line">    <span class="k">virtual</span> <span class="n">InputSource</span> <span class="o">*</span> <span class="n">resolveEntity</span><span class="p">(</span><span class="k">const</span> <span class="n">XMLCh</span> <span class="o">*</span> <span class="k">const</span> <span class="n">publicId</span><span class="p">,</span>
</span><span class="line">        <span class="k">const</span> <span class="n">XMLCh</span> <span class="o">*</span> <span class="k">const</span> <span class="n">systemId</span><span class="p">)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">if</span> <span class="p">(</span><span class="n">Compare</span><span class="p">(</span><span class="n">systemId</span><span class="p">,</span> <span class="s">L&quot;http://www.w3.org/TR/voicexml20/vxml.xsd&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class="line">            <span class="n">VXIcharToXMLCh</span> <span class="n">name</span><span class="p">(</span><span class="s">L&quot;http://www.w3.org/TR/voicexml20/vxml.xsd (SB)&quot;</span><span class="p">);</span>
</span><span class="line">            <span class="k">return</span> <span class="k">new</span> <span class="n">MemBufInputSource</span><span class="p">(</span><span class="n">VALIDATOR_DATA</span> <span class="o">+</span> <span class="n">VALIDATOR_VXML</span><span class="p">,</span>
</span><span class="line">                <span class="n">VALIDATOR_VXML_SIZE</span><span class="p">,</span>
</span><span class="line">                <span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="kc">false</span><span class="p">);</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="p">(</span><span class="n">Compare</span><span class="p">(</span><span class="n">systemId</span><span class="p">,</span> <span class="s">L&quot;http://www.w3.org/2001/xml.xsd&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class="line">            <span class="n">VXIcharToXMLCh</span> <span class="n">name</span><span class="p">(</span><span class="s">L&quot;http://www.w3.org/2001/xml.xsd&quot;</span><span class="p">);</span>
</span><span class="line">            <span class="k">return</span> <span class="k">new</span> <span class="n">MemBufInputSource</span><span class="p">(</span><span class="n">VALIDATOR_DATA</span> <span class="o">+</span> <span class="n">VALIDATOR_XML</span><span class="p">,</span>
</span><span class="line">                <span class="n">VALIDATOR_XML_SIZE</span><span class="p">,</span>
</span><span class="line">                <span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="kc">false</span><span class="p">);</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="p">(</span><span class="n">Compare</span><span class="p">(</span><span class="n">systemId</span><span class="p">,</span> <span class="s">L&quot;XMLSchema.dtd&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class="line">            <span class="n">VXIcharToXMLCh</span> <span class="n">name</span><span class="p">(</span><span class="s">L&quot;XMLSchema.dtd&quot;</span><span class="p">);</span>
</span><span class="line">            <span class="k">return</span> <span class="k">new</span> <span class="n">MemBufInputSource</span><span class="p">(</span><span class="n">VALIDATOR_DATA</span> <span class="o">+</span> <span class="n">VALIDATOR_SCHEMA_DTD</span><span class="p">,</span>
</span><span class="line">                <span class="n">VALIDATOR_SCHEMA_DTD_SIZE</span><span class="p">,</span>
</span><span class="line">                <span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="kc">false</span><span class="p">);</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">
</span><span class="line">        <span class="c1">// ......</span>
</span><span class="line">
</span><span class="line">        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="c1">// ......</span>
</span><span class="line">
</span><span class="line"><span class="n">parser</span> <span class="o">=</span> <span class="n">XMLReaderFactory</span><span class="o">::</span><span class="n">createXMLReader</span><span class="p">();</span>
</span><span class="line"><span class="n">DTDResolver</span> <span class="o">*</span> <span class="n">dtd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DTDResolver</span><span class="p">();</span>
</span><span class="line"><span class="n">parser</span><span class="o">-&gt;</span><span class="n">setEntityResolver</span><span class="p">(</span><span class="n">dtd</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>在测试中发现，对某些外部实体的访问成功截取了，但是另外一些却不成功，parser依然尝试通过网络访问，然后由于网络不通而访问失败，造成xml文件无法parse。</p>

<p>对程序进行跟踪，发现了问题出现的规律：所有对schema文件的引用处理都正常，无论是include还是import方式，也无论是多少层的间接引用；在被parse的XML文件中DOCTYPE声明的外部实体引用，处理也正常，故此xerces自带的redirect例子是不会出问题的；但是，schema文件的DOCTYPE声明的外部实体引用就不能被正确处理了，根本不会调用指定的resolveEntity()方法。</p>

<p>这时，基本上可以确认问题是出在xerces身上，而不是我们的程序的问题了。于是仔细跟踪xerces代码对schema parse的执行过程，最终发现了问题。</p>

<p>XercesDOMParser类有两个resolveEnitiy方法：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="n">InputSource</span><span class="o">*</span> <span class="n">XercesDOMParser</span><span class="o">::</span><span class="n">resolveEntity</span><span class="p">(</span><span class="k">const</span> <span class="n">XMLCh</span><span class="o">*</span> <span class="k">const</span> <span class="n">publicId</span><span class="p">,</span>
</span><span class="line">                                            <span class="k">const</span> <span class="n">XMLCh</span><span class="o">*</span> <span class="k">const</span> <span class="n">systemId</span><span class="p">,</span>
</span><span class="line">                                            <span class="k">const</span> <span class="n">XMLCh</span><span class="o">*</span> <span class="k">const</span> <span class="n">baseURI</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">fEntityResolver</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">fEntityResolver</span><span class="o">-&gt;</span><span class="n">resolveEntity</span><span class="p">(</span><span class="n">publicId</span><span class="p">,</span> <span class="n">systemId</span><span class="p">);</span>
</span><span class="line">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="n">InputSource</span><span class="o">*</span> <span class="n">XercesDOMParser</span><span class="o">::</span><span class="n">resolveEntity</span><span class="p">(</span><span class="n">XMLResourceIdentifier</span><span class="o">*</span> <span class="n">resourceIdentifier</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">fEntityResolver</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">fEntityResolver</span><span class="o">-&gt;</span><span class="n">resolveEntity</span><span class="p">(</span><span class="n">resourceIdentifier</span><span class="o">-&gt;</span><span class="n">getPublicId</span><span class="p">(),</span>
</span><span class="line">                                                <span class="n">resourceIdentifier</span><span class="o">-&gt;</span><span class="n">getSystemId</span><span class="p">());</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">fXMLEntityResolver</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">fXMLEntityResolver</span><span class="o">-&gt;</span><span class="n">resolveEntity</span><span class="p">(</span><span class="n">resourceIdentifier</span><span class="p">);</span>
</span><span class="line">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>根据代码注释，前者是deprecated的，被后者代替。</p>

<p>由XercesDOMParser派生出XSDDOMParser类，这个类是专门用来parser xsd文件（也就是schema）的。这个类重载了XercesDOMParser的三个参数的resolveEntity方法，用fUserEntityHandler代替fEntityResolver的方法调用。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="n">InputSource</span><span class="o">*</span> <span class="n">XSDDOMParser</span><span class="o">::</span><span class="n">resolveEntity</span><span class="p">(</span><span class="k">const</span> <span class="n">XMLCh</span><span class="o">*</span> <span class="k">const</span> <span class="n">publicId</span><span class="p">,</span>
</span><span class="line">                                         <span class="k">const</span> <span class="n">XMLCh</span><span class="o">*</span> <span class="k">const</span> <span class="n">systemId</span><span class="p">,</span>
</span><span class="line">                                         <span class="k">const</span> <span class="n">XMLCh</span><span class="o">*</span> <span class="k">const</span> <span class="n">baseURI</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">fUserEntityHandler</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">fUserEntityHandler</span><span class="o">-&gt;</span><span class="n">resolveEntity</span><span class="p">(</span><span class="n">publicId</span><span class="p">,</span> <span class="n">systemId</span><span class="p">,</span> <span class="n">baseURI</span><span class="p">);</span>
</span><span class="line">
</span><span class="line">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>但是XSDDOMParser没有重载第二个resolveEntity方法，估计是第二个方法是后来才加入XercesDOMParser的，在XSDDOMParser中没有同步修改。因此，依然是使用fEntityResolver，而不是fUserEntityHandler，就造成了没有调用到我们定义的resolveEntity方法，依然按照原来的system id去访问网络了。</p>

<p>问题找出来，解决就简单了，在XSDDOMParser中把另外一个resolveEntity方法也重载了，改为使用fUserEntityHandler。修改之后，测试通过。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="n">InputSource</span><span class="o">*</span> <span class="n">XSDDOMParser</span><span class="o">::</span><span class="n">resolveEntity</span><span class="p">(</span><span class="n">XMLResourceIdentifier</span><span class="o">*</span> <span class="n">resourceIdentifier</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">fUserEntityHandler</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">fUserEntityHandler</span><span class="o">-&gt;</span><span class="n">resolveEntity</span><span class="p">(</span><span class="n">resourceIdentifier</span><span class="p">);</span>
</span><span class="line">
</span><span class="line">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>这个问题在Xerces-C 2.4和2.5版本都存在，IBM的XML4C与Xerces-C是影子项目，也有同样的问题。</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2004/04/30/Solve-Xerces-C-XML-parser-EnitiyResolver-doesn-t-work-in-the-problem/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2004/04/10/How-to-increase-the-number-of-Windows-programs-thread-/">如何增加windows程序的线程数量?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2004-04-10T06:10:00+08:00" pubdate data-updated="true">2004-04-10</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/softwaredev/'>SoftwareDev</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p>编写测试程序, 发现超过1000个线程, 程序执行就会出现内存错误. 原来我还以为是windows对线程数量有限制, 查资料才知道支持线程多少并不是操作系统决定的, 而是与程序的堆栈空间大小有关.</p>

<p>在VC中, 修改Project Setting - Link - Stack allocation - Reserve, 缺省为1M(0x100000), 将这个数值降低, 也就是减少每个线程的栈空间大小, 就可以增加线程数量. 这是因为用户地址空间总共是2GB, 线程保留栈空间大小乘以线程数量不能大于2GB.</p>

<p>因为上下文切换的开销, 线程过多效率会降低, 我做这个测试程序就是想知道这个效率曲线到底是怎样的.</p>

<p>以下为网上找到的资料:</p>

<p>I just found this under CreateThread() in MSDN:  </p>

<p>The number of threads a process can create is limited by the available virtual memory. By default, every thread has one megabyte of stack space. Therefore, you can create at most 2028 threads. If you reduce the default stack size, you can create more threads. However, your application will have better performance if you create one thread per processor and build queues of requests for which the application maintains the context information. A thread would process all requests in a queue before processing requests in the next queue.  </p>

<p>So the number of threads you can create is capped by the 2 GB user address space available to your process.  </p>

<p>So you have a few choices, as I see it:  </p>

<p>1) Run multiple copies of your server at once and coordinate between them. You will need endless amounts of swap space.<br />
2) Reduce the amount of stack used per thread (lowering from 1 Mb to 100Kb should get you 40,000 threads).<br />
3) Re-architect your app to not require one thread per connection. Have each thread monitor many connections using (for example) a select() call.</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2004/04/10/How-to-increase-the-number-of-Windows-programs-thread-/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/blog/page/46/">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/blog/page/44/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Note</h1>
  <p>中国大陆用户可能会因为网络被屏蔽而无法访问本网站或部分内容(文字/图片), 如遇到这种情况, 请翻墙访问</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/03/22/clean-aged-artifacts-from-artifactory/">Clean aged artifacts from Artifactory</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/19/maven-batch-deploy-artifacts/">Batch deploy artifacts to Maven repository</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/18/stand-up-desk/">站立工作环境</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/10/which-app-is-draining-your-android-bettery/">怎么处理Android耗电严重的问题</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/09/beginning-r/">R初略学习笔记</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
<a style="font-size: 138%" href="/blog/tags/android/">Android</a>
<a style="font-size: 113%" href="/blog/tags/anti-gfw/">Anti-GFW</a>
<a style="font-size: 93%" href="/blog/tags/appserver/">AppServer</a>
<a style="font-size: 99%" href="/blog/tags/architecture/">Architecture</a>
<a style="font-size: 70%" href="/blog/tags/artculture/">ArtCulture</a>
<a style="font-size: 116%" href="/blog/tags/blogging/">Blogging</a>
<a style="font-size: 113%" href="/blog/tags/civilsociety/">CivilSociety</a>
<a style="font-size: 111%" href="/blog/tags/diy/">DIY</a>
<a style="font-size: 70%" href="/blog/tags/datavisualization/">DataVisualization</a>
<a style="font-size: 70%" href="/blog/tags/database/">Database</a>
<a style="font-size: 70%" href="/blog/tags/design/">Design</a>
<a style="font-size: 70%" href="/blog/tags/environmentalprotection/">EnvironmentalProtection</a>
<a style="font-size: 70%" href="/blog/tags/excel/">Excel</a>
<a style="font-size: 99%" href="/blog/tags/funny/">Funny</a>
<a style="font-size: 143%" href="/blog/tags/gps-gis/">GPS_GIS</a>
<a style="font-size: 70%" href="/blog/tags/gadget/">Gadget</a>
<a style="font-size: 70%" href="/blog/tags/geek/">Geek</a>
<a style="font-size: 70%" href="/blog/tags/geocaching/">Geocaching</a>
<a style="font-size: 70%" href="/blog/tags/homeappliance/">HomeAppliance</a>
<a style="font-size: 140%" href="/blog/tags/idea/">Idea</a>
<a style="font-size: 111%" href="/blog/tags/imageprocessing/">ImageProcessing</a>
<a style="font-size: 93%" href="/blog/tags/java/">Java</a>
<a style="font-size: 70%" href="/blog/tags/learning/">Learning</a>
<a style="font-size: 111%" href="/blog/tags/life/">Life</a>
<a style="font-size: 99%" href="/blog/tags/maven/">Maven</a>
<a style="font-size: 139%" href="/blog/tags/misc/">Misc</a>
<a style="font-size: 107%" href="/blog/tags/mywork/">MyWork</a>
<a style="font-size: 84%" href="/blog/tags/novel/">Novel</a>
<a style="font-size: 84%" href="/blog/tags/outdoor/">Outdoor</a>
<a style="font-size: 104%" href="/blog/tags/personaldevelopment/">PersonalDevelopment</a>
<a style="font-size: 70%" href="/blog/tags/r/">R</a>
<a style="font-size: 118%" href="/blog/tags/reading/">Reading</a>
<a style="font-size: 120%" href="/blog/tags/running/">Running</a>
<a style="font-size: 70%" href="/blog/tags/sip/">SIP</a>
<a style="font-size: 136%" href="/blog/tags/software/">Software</a>
<a style="font-size: 160%" href="/blog/tags/softwaredev/">SoftwareDev</a>
<a style="font-size: 93%" href="/blog/tags/springframework/">SpringFramework</a>
<a style="font-size: 84%" href="/blog/tags/statistics/">Statistics</a>
<a style="font-size: 125%" href="/blog/tags/sysadmin/">SysAdmin</a>
<a style="font-size: 120%" href="/blog/tags/timemanagement/">TimeManagement</a>
<a style="font-size: 84%" href="/blog/tags/ux/">UX</a>
<a style="font-size: 107%" href="/blog/tags/web/">Web</a>
<a style="font-size: 99%" href="/blog/tags/weblogic/">WebLogic</a>
<a style="font-size: 70%" href="/blog/tags/i18n/">i18n</a>

  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Leo Liang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'aleung';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

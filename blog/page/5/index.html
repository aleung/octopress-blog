
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Good good study, day day up</title>
  <meta name="author" content="Leo Liang">

  
  <meta name="description" content="目前在PC上使用SSH tunnel翻墙是一个相当广泛使用的方案，国外SSH帐号的获取不是太难，购买起来价格也比VPN帐号要便宜。但是在智能手机上目前还不能使用SSH方案，只能用VPN。Android系统是基于Linux的，特别是root了之后，基本上要玩什么都随心所欲了。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://aleung.github.com/blog/blog/page/5/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="/blog/javascripts/ender.js"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/GoodGoodStudyDayDayUp" rel="alternate" title="Good good study, day day up" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Good good study, day day up</a></h1>
  
    <h2>aleung的学习笔记, aleung的idea</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/GoodGoodStudyDayDayUp" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:aleung.github.com/blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/06/02/Consider-how-in-the-Android-mobile-phones-in-use-SSH-tunnel-over-the-wall/">在考虑怎样在Android手机上使用SSH Tunnel翻墙</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-02T14:53:00+08:00" pubdate data-updated="true">2010-06-02</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/android/'>Android</a>, <a class='tag' href='/blog/tags/anti-gfw/'>Anti-GFW</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p>目前在PC上使用SSH tunnel翻墙是一个相当广泛使用的方案，国外SSH帐号的获取不是太难，购买起来价格也比VPN帐号要便宜。但是在智能手机上目前还不能使用SSH方案，只能用VPN。Android系统是基于Linux的，特别是root了之后，基本上要玩什么都随心所欲了。因此Android上是应该也可以使用SSH tunnel的。</p>

<p>先看看Windows上是怎样设置SSH翻墙的：</p>

<ul>
  <li>首先需要有个支持dynamic port forwarding的SSH client，这个SSH client能开放出SOCKS服务</li>
  <li>如果浏览器(或者其他程序)支持使用SOCKS proxy，设置使用SSH client开放出来的SOCKS端口，就可以使用了</li>
  <li>如果浏览器(或者其他程序)不支持SOCKS proxy，只支持HTTP proxy，就需要再运行一个支持SOCKS的代理程序（例如Privoxy），将HTTP转成SOCKS</li>
</ul>

<p><img src="http://farm5.static.flickr.com/4046/4662779602_743c1c50c2_b.jpg" alt="" /></p>

<p>在Android上就要麻烦一点了，因为需要网络通讯的不仅仅是浏览器，很多Android application都需要访问网络，但是它们并不支持proxy—-连HTTP proxy都不支持，更不用说SOCKS了。它们只会直接连接目标站点，如图中虚线所示，然后撞墙。</p>

<p>但是Linux有iptables，可以设置iptables规则（需要root权限），将HTTP/HTTPS请求forward到一个transparent SOCKS proxy去。transparent SOCKS proxy的作用是将任意TCP连接转成SOCKS连接，这样就可以走SSH tunnel出去了。我分析过几乎所有的Android应用访问网络都是走HTTP/HTTPS协议的，所有仅仅处理HTTP/HTTPS就够了。</p>

<p><img src="http://farm5.static.flickr.com/4023/4662779594_32dd9773cb_b.jpg" alt="" /></p>

<p>Android上支持dynamic port forwarding的SSH client有<a href="http://code.google.com/p/connectbot/">ConnectBot</a>，不过ConnectBot是一个有界面的应用，似乎不能由其他程序来控制，这样就不好做到翻墙软件的傻瓜化了。应该还是弄一个命令行的ssh client更合适。</p>

<p>在网上搜索了一下，开源的transparent SOCKS proxy有几个：<a href="http://oss.tiggerswelt.net/transocks_ev/">transocks_ev</a>，<a href="http://transocks.sourceforge.net/">TranSocks</a> 和 <a href="http://darkk.net.ru/redsocks/">redsocks</a>。从文档上看，似乎transocks_ev比较适合。</p>

<p>但是，我现在面临的困难在于我不熟悉如何交叉编译Android平台程序（C语言），了解了一下如何搭建Android交叉编译环境，似乎挺麻烦（对我而言）。而且要让普通Linux上可运行的sshd和transocks port到Android上，也许还有一些代码要修改。不知道有没有Android系统高手能够帮忙？</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2010/06/02/Consider-how-in-the-Android-mobile-phones-in-use-SSH-tunnel-over-the-wall/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/05/11/Nexus-One-/">Nexus One 到手，以及刷机过程</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-11T20:10:00+08:00" pubdate data-updated="true">2010-05-11</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/android/'>Android</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p>昨天终于拿到了Google赠送的Nexus One手机了，Google做事也够拖拖拉拉的，确认信说两个星期左右会寄到，实际上用了两个多月。不过还是得感谢Google，我去年开通Android Developer帐号的时候还埋怨，我只是发布免费软件，都要我交25美元才能开通。Google送我手机的原因是因为我符合它的Android开发者推广计划的条件：开发的Android应用下载量超过5000，用户评价高于3.5星。我的 HereIm Map Helper 和 Wallpaper Label 都符合条件。</p>

<p>原来用的G1因为内存太小，运行速度很卡。Nexus One用起来的第一感受就是顺畅，另外就是屏幕显示效果很艳丽。</p>

<p>机器是2.1的系统，但是没有root，因此正式使用前的第一件事情就是刷机。上网看了一些文章，大部分写得罗里罗嗦的，完全没有重点，真正动手做其实就是简单几步。下面不写具体操作过程，因为网上一大堆。</p>

<h3 id="section">准备</h3>

<p>PC上要安装好USB驱动和fastboot、adb工具。工具是Android SDK附带的，装好SDK就有。</p>

<h3 id="unlock-bootloader">Unlock bootloader</h3>

<p>Unlock了之后才允许进行刷机操作。Unlock后开机时会显示一个打开的锁的图标，说明这台机器已经unlock了，也就是无保修了。只要unlock了，下面的操作都可以进行了，不一定要按照先后顺序。</p>

<h3 id="recovery">更新recovery</h3>

<p>下载Amon_RA做的recovery image，用fastboot工具写入手机。安装新ROM或者patch都需要通过recovery来进行，其实系统已经自带了recovery，不更换也能用，但是Amon_RA的功能更强，使用起来会方便很多。</p>

<h3 id="radio">更新radio</h3>

<p>我检查了一下，自带的radio已经是最新版本，所以跳过了这个步骤。</p>

<h3 id="rom">安装新版本的ROM</h3>

<p>我装的是CyanogenMod的ROM，比较可靠。这个ROM是带root的，装起来就有root权限了。因为CM的ROM是不带Google Applications的（版权问题），所以还需要再刷个GoogleApp包（网上可找到，目前最新版本是EPE54B），这个包应该是通过Google官方升级包制作出来的。如果装的是其他版本的ROM，例如国内的人制作的，通常已经把Google应用内置进去了，就不需要额外步骤。</p>

<p>对我而言，到此为止刷机过程就完成了。有些人还要再打其他的patch，例如中文排序、theme之类的。</p>

<h3 id="romroot">不更换ROM，获取root</h3>

<p>是否有root权限，是与ROM相关的，例如我刷了CM 5.0.6就有root权限了。有些人不想换ROM，沿用官方的系统，但又想要root权限，就需要刷hack过的superboot image。要注意下载superboot image的时候，要选择跟ROM一致的版本，例如目前官方正式发布的最新ROM版本是ERE27。版本号从手机信息界面可以查到。</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2010/05/11/Nexus-One-/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/05/01/DIY-Sheldon-/">DIY一个Sheldon用的叠衣板</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-01T23:25:00+08:00" pubdate data-updated="true">2010-05-01</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/diy/'>DIY</a>, <a class='tag' href='/blog/tags/life/'>Life</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p>在《<a href="http://movie.douban.com/subject/2156528/">生活大爆炸</a>》第一季中某集的场景是Sheldon在洗衣房里叠衣服，他用的是叠衣板，衣服铺上面翻三下，就方方正正的叠好了。没看过的同学可以看看下面的youtube视频片段（需要翻墙）：</p>

<p>看着觉得真好玩，于是去淘宝找一下。淘宝果然没有买不到的东西，叫做神奇叠衣板，山寨货几十块钱，可是看了不少评价都说质量不好。在网上搜索的时候无意中看到有人说自己DIY，是啊，这么简单的东西，为什么不自己做呢。</p>

<p><a href="http://www.flickr.com/photos/leoliang/4567523723/"><img src="http://farm5.static.flickr.com/4008/4567523723_7775160d6f_o.jpg" alt="DIY cloth folder" /></a></p>

<p>找到装电压力锅的纸盒，当时觉得可能还有用没舍得扔，果然派上用场了。制作非常简单，无非就是切割、折叠、粘贴固定。</p>

<p><a href="http://www.flickr.com/photos/leoliang/4567523741/"><img src="http://farm4.static.flickr.com/3298/4567523741_6b42abf4a5_o.jpg" alt="DIY cloth folder" /></a></p>

<p>自己做还有个好处是可以根据自己衣柜的尺寸来做，最大化的利用空间。图中的W和H是期望叠出来的衣服的尺寸，要考虑衣服折叠后的厚度，所以要折边处要预留1～2厘米。</p>

<p>下面是做好的成品，虽然不大好看，但是实践证明还是相当好用的 :)</p>

<p><a href="http://www.flickr.com/photos/leoliang/4567523739/"><img src="http://farm5.static.flickr.com/4008/4567523739_677118ef91_o.jpg" alt="DIY cloth folder" /></a></p>

<p><a href="http://www.flickr.com/photos/leoliang/4567523737/"><img src="http://farm4.static.flickr.com/3298/4567523737_94cb2b1211_o.jpg" alt="DIY cloth folder" /></a></p>

<p>叠衣服的过程就是四步：铺好，如果衣袖和下摆过长超出叠衣板的边缘就先把它翻进来，然后将叠衣板左、右、下翻三下，ok。</p>

<p><a href="http://www.flickr.com/photos/leoliang/4567523735/"><img src="http://farm5.static.flickr.com/4067/4567523735_fa5a268e89_o.jpg" alt="DIY cloth folder" /></a></p>

<p>做好了很兴奋，正好衣柜里的衣服要换季了，把夏装拿出来，全部重新叠了一遍。用叠衣板后，叠一件衣服的时间不见得能快多少，但好处是叠得方正，一摞下来每件的大小都一模一样，放衣柜里整整齐齐。薄衣服的效果都很好，包括tee、衬衫、秋衣之类，但不能用来叠厚衣服，例如毛衣。其实也不是叠衣板的问题，而是厚衣服不能叠成这么小的面积，如果有必要可以专门再做一个大尺寸的用来叠厚衣服。</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2010/05/01/DIY-Sheldon-/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/04/13/Reading-feeling-contact-and-the-space-Life-between-buildings-/">读书感想：交往与空间 (Life Between Buildings)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-04-13T22:46:00+08:00" pubdate data-updated="true">2010-04-13</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/reading/'>Reading</a>, <a class='tag' href='/blog/tags/建筑/'>建筑</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://book.douban.com/subject/1393903/">交往与空间</a>是一本关于城市规划如何影响人的生活，怎样才能让城区更富于生机和魅力，让生活其中的人更愉快舒畅的书。这本书探讨了怎样的城市是真正的宜居城市。</p>

<p>周末花了大半天时间看完了这本书，看书过程挺享受的，很久没有认真看书了。边看边用手机在twitter上发读书感想，twitter是一个不错的记录读书感想的工具。</p>

<hr />

<p>为什么老城区会让人感觉亲切?因为公共空间尺度合适，不是宏大而单调；空间没有被宽阔的机动车道割裂，联系紧密；空间功能多元化，各种人群各种活动融合在一起更有生机。</p>

<p>现在发达国家的城市规划逐渐摒弃功能主义，让每个区域的功能趋于综合化，使得空间更有生气和活力，也减少了时间性单向的交通压力。但我们的城市规划还是喜欢搞单一的商务区，高科技园，大学城。</p>

<p>“通过人的观察与感受，使公共环境中的活动与毗邻的住宅商店车间工厂的各种活动融会贯通，就能从双向扩展和丰富体验的可能性”：这是新的理念，在欧洲就见过不少临街办公室开着大大的玻璃窗并且毫无遮挡，外面对里面的东西和活动一览无遗。在瑞典，私人住宅的阳台和院落大多都是通透的，夏日经常见到有人在阳台上闲坐观望甚至用餐，外面的人也看到他们，大家互为风景。</p>

<p>步行者走捷径的愿望是非常执着的，如果可以看到目标，他们总是径直走向那里。因此，很多草坪花基是注定要被践踏的，与其竖牌子搭栏杆还不如想想怎样能够方便行人。</p>

<p>当去远处目的地的路程一览无遗时，步行就会索然无味；但看得见目的地而又不得不绕行，则更令人扫兴和不悦。蜿蜒富于变化的街道使步行变得更有趣，因此在老城古镇中闲逛是一种享受，特别是拐过一个弯，一个小广场一座特别建筑或是一个雕塑突然显露眼前时更令人惊喜。</p>

<p>一个理想的居住空间应该是既有足够的私人空间，也有良好的可活动的公共空间。现在我们的居住环境是普遍提高了，但公共空间却几乎没有。回家关上双重防盗门，窗户阳台还有防盗网，基本与外界隔绝。有小区花园的也没有多少可闲坐的地方。比起以前小孩可在街头玩耍，街坊在门前聊天，我们城市离宜居更远了。</p>

<p>我们这里一些郊区大盘算是有些公共空间，但还不是有活力的空间。因为开发的思路是纯住宅区，像祈福要买点东西都要跑到外头去。适当的商业其实是有益的。</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2010/04/13/Reading-feeling-contact-and-the-space-Life-between-buildings-/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/03/23/The-old-city-relativity-dialogue-old-city-device-art/">旧城相对论 - 对话旧城装置艺术展</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-03-23T23:30:00+08:00" pubdate data-updated="true">2010-03-23</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/文化艺术/'>文化艺术</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p>这个活动由<a href="http://www.firexrd.com/Blog/?p=603">FIREXRD</a>发起，他以”<a href="http://zh.wikipedia.org/zh-cn/File:Chanyuengposter.jpg">广州撑你</a>“海报而闻名。豆瓣同城上也有<a href="http://www.douban.com/event/11600836/">活动页面</a>。</p>

<p><a href="http://www.flickr.com/photos/leoliang/4457516716/"><img src="http://farm5.static.flickr.com/4049/4457516716_34649e402d_o.jpg" alt="旧城相对论" /></a></p>

<p>展览在北京路的<a href="http://225.goelia.com.cn/">歌莉娅225概念会所</a>进行，展厅面积很小，但这是由观众参与完成的装置艺术，你在那里看到的不是完成后的作品，而是不断动态更新中的，并且每人都可以参与其中。另外这个会所也值得一赞，在是旧建筑保育与商业利用结合的成功例子。</p>

<p>“感谢国家，我冇意见，谢绝跨省”</p>

<p><a href="http://www.flickr.com/photos/leoliang/4457512786/"><img src="http://farm3.static.flickr.com/2759/4457512786_e9a1222544_o.jpg" alt="旧城相对论" /></a></p>

<p>这个更加猛：</p>

<p><a href="http://www.flickr.com/photos/leoliang/4457511592/"><img src="http://farm5.static.flickr.com/4006/4457511592_2c05c2fd31_o.jpg" alt="旧城相对论" /></a></p>

<p>当然，发泄怨气的其实还是少数，大多数都是表达对老建筑以及其上承载的文化的留恋。</p>

<p><a href="http://www.flickr.com/photos/leoliang/4456734439/"><img src="http://farm5.static.flickr.com/4020/4456734439_b293ff5282_o.jpg" alt="旧城相对论" /></a></p>

<p>这是我和清风白云的”创作”：</p>

<p>Big brother is watching you!</p>

<p><a href="http://www.flickr.com/photos/leoliang/4456736391/"><img src="http://farm5.static.flickr.com/4042/4456736391_192618ca5b_o.jpg" alt="旧城相对论" /></a></p>

<p>这也是我们搞的，我们向往信息的自由：</p>

<p><a href="http://www.flickr.com/photos/leoliang/4456735659/"><img src="http://farm3.static.flickr.com/2700/4456735659_d6f35ef45e_o.jpg" alt="旧城相对论" /></a></p>
</div>
  
  
  
    <footer>
        <a href="/blog/2010/03/23/The-old-city-relativity-dialogue-old-city-device-art/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/03/19/Grab-Android-system-on-network-communication/">抓取Android系统上的网络通信</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-03-19T13:33:00+08:00" pubdate data-updated="true">2010-03-19</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/android/'>Android</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p>Android是基于Linux的系统，这是对开发者很方便的。今天手机上网不太正常，想到抓些包来看看，于是上网google一下，就找到教程了：<a href="http://pdk.android.com/online-pdk/guide/tcpdump.html">Debugging with Tcpdump</a>。我的ROM没有预装tcpdump（据说cm的rom有），自己编译也太麻烦了，网上也可以找到编译好的包，搜索”tcpdump-arm”可找到。</p>

<p>有了tcpdump，要分析别人的应用干了些什么也方便多了。例如这是 Google Maps 获取network location的包：</p>

<pre><code>POST /loc/m/api HTTP/1.1
Connection: close
Content-Type: application/binary
Content-Length: 496
Host: www.google.com
User-Agent: GMM/3.0 (dream ERE27); gzip

...."location,1.0,android,android,en_US... I.....g...........g:loc/ql......
..
.1.0.Iandroid/google/passion/passion/mahimahi:2.1/ERD72/22132:user/release-keys.#2:l-7Yxu1UHhuUZlb5:F_iqbZnw84bV2J0q*.zh_CN2
....CMCC .(...
.voicesearch..
.com.diddo.diddo.diddo..
.apps.maps..
.com.lim.android.automemman"..
..
...I...... ..(.......$....I...... ..(.....I...... ..(.....I...... ..(.....I...... ..(.....I...... ..(."...I...... ..(.0..K"...I...... ..(.0..J"...I...... ..(.0..."...I...... ..(.0...(......


HTTP/1.1 200 OK
Content-Type: application/binary
Content-Disposition: attachment
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Pragma: no-cache
Expires: Fri, 01 Jan 1990 00:00:00 GMT
Date: Fri, 19 Mar 2010 04:49:31 GMT
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Content-Length: 188
Server: GSE
X-XSS-Protection: 0
Connection: close

..............g...)...........`.Z... $...k.......fg./,
.....,.."....cZ
....(.
!'....S`..F...3..BP.n..j...`Q{..V..v...Z'yT;.j...]..Q+.U.d.Pm.,6..aj..j_....=..T...
goB. .U....s7.......#
)...
</code></pre>

<p>不过payload是binary的，没法直接看出里面是些什么东西。</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2010/03/19/Grab-Android-system-on-network-communication/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/03/11/Study-of-the-issue-that-CXF-can-t-run-on-GlassFish/">Study of the Issue That CXF Can&#8217;t Run on GlassFish</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-03-11T11:59:00+08:00" pubdate data-updated="true">2010-03-11</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/softwaredev/'>SoftwareDev</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="issue">Issue</h2>

<p>SOAP WS client which uses CXF can’t run on GlassFish AS. Getting ClassCastException on invoking some CXF API. The problem was described as CXF-2237 [2].</p>

<h2 id="analysis">Analysis</h2>

<p>JAX-WS is the Java API for XML Web Service defined by JSR 224. SUN provides a JAX-WS reference implementation in Metro project, which is inside GlassFish AS. The SUN JAX-WS implement was later also merged into JDK 6. Apache CXF is another JAX-WS implementation.</p>

<p>An application can select different JAX-WS implementation by Provider SPI. JSR 224 [4] chapter 6.2.1 defines the algorithm of Provider implementation selection:</p>

<blockquote>
  <ol>
    <li>
      <p>If a resource with the name of META-INF/services/javax.xml.ws.spi.Provider exists, then its first line, if present, is used as the UTF-8 encoded name of the implementation class.</p>
    </li>
    <li>
      <p>If the ${java.home}/lib/jaxws.properties file exists and it is readable by the java.util.Properties.load(InputStream) method and it contains an entry whose key is javax.xml.ws.spi.Provider, then the value of that entry is used as the name of the implementation class.</p>
    </li>
    <li>
      <p>If a system property with the name javax.xml.ws.spi.Provider is defined, then its value is used as the name of the implementation class.</p>
    </li>
    <li>
      <p>Finally, a default implementation class name is used.</p>
    </li>
  </ol>
</blockquote>

<p>The Provider implementation class in JDK 6 is <code>com.sun.xml.internal.ws.spi.ProviderImpl</code> in rt.jar. I guess it’s the default implementation as mentioned in step 4.</p>

<p>CXF packages META-INF/services/javax.xml.ws.spi.Provider which points to <code>org.apache.cxf.jaxws.spi.ProviderImpl</code> in cxf.jar. It will be considered in step 1.</p>

<p>Metro also packages META-INF/services/javax.xml.ws.spi.Provider which points to <code>com.sun.xml.ws.spi.ProviderImpl</code> in webservices-rt.jar. It also will be considered in step 1.</p>

<p>Because in GlassFish the Metro library is in system classpath, so its META-INF/services/javax.xml.ws.spi.Provider will be loaded precede over CXF’s. That’s why Metro will always be used as JAX-WS implement no matter CXF exists or not.</p>

<h2 id="potential-solution">Potential Solution</h2>

<h3 id="classloader-control">Classloader control</h3>

<p>If we can force the JVM to load resource from cxf.jar prior to webservices-rt.jar that will be fine. But GlassFish hasn’t the mechanism likeWebLogic’s <code>&lt;prefer-application-packages&gt;</code>[5]. After some finding we give up this approach.</p>

<h3 id="remove-metro-from-glassfish">Remove Metro from GlassFish</h3>

<p>If there is no application which deploys on the this application server that depends on Metro, we can remove Metro lib (webservices-*.jar) from GlassFish’s lib folder.</p>

<h3 id="change-to-metro">Change to Metro</h3>

<p>That’s nothing to say. We finally choose this way. There is almost no workload to migrate our code from CXF to Metro, because both of them follows JAX-WS specification, except that some code that calls CXF specify API need to be changed. We even don’t change the build script and still use CXF’s wsdl2java tool.</p>

<h2 id="reference">Reference</h2>

<ol>
  <li><a href="https://issues.apache.org/jira/browse/CXF-857">CXF Issue: CXF-857</a></li>
  <li><a href="https://issues.apache.org/jira/browse/CXF-2237">CXF Issue: CXF-2237</a></li>
  <li><a href="http://stackoverflow.com/questions/2064068/how-to-pick-cxf-over-metro-on-glassfish">StackOverflow: How to pick CXF over Metro on Glassfish</a></li>
  <li><a href="http://jcp.org/en/jsr/detail?id=224">JSR 224: JAX-WS 2.x</a></li>
  <li><a href="http://good-good-study.appspot.com/blog/posts/4218">WebLogic的classloading</a></li>
</ol>
</div>
  
  
  
    <footer>
        <a href="/blog/2010/03/11/Study-of-the-issue-that-CXF-can-t-run-on-GlassFish/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/02/27/Portable-pedestrians-cross-the-street-warning-great/">便携式行人过街警示棒</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-02-27T01:40:00+08:00" pubdate data-updated="true">2010-02-27</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/idea/'>Idea</a>, <a class='tag' href='/blog/tags/交通/'>交通</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://farm5.static.flickr.com/4010/4390272360_cd4c3c040a_o.jpg" alt="" /></p>

<p>几乎每次过马路，我都恨不得手里有这样一块牌子，可以伸到身体前面，把来车挡住 —- 在没有交通灯的斑马线，十个司机有九个会毫不减速的冲过，而不会避让过马路的行人；即使在有交通灯的斑马线，如果不是路口，也有司机根本当红灯不存在。</p>

<p>我想，能不能做个可伸缩的棒，例如是套筒的方式，里面加上弹簧，缩起来的时候大概烟盒大小，可以方便的放在口袋，当需要过马路的时候，将它弹出来，变成一米左右的长度。棒身用红、黄鲜艳颜色的反光材料覆盖。为了增大可视面积，棒伸展时需要在前端弹出一个平面，应该用个弹性钢丝圈加上薄膜可以做出来，类似可折叠太阳帽的样子。过完马路后一压就能够把警示棒收起来。</p>

<p>Beatles四位大叔过Abbey Road时就是这样子的：</p>

<p><img src="http://farm5.static.flickr.com/4003/4390322224_a0a6979623_o.jpg" alt="" /></p>

<p>现在激光全息成像技术还不成熟，如果能够做到便携化，还可以从口袋里掏出激光器一照，一个栅栏就出来了：</p>

<p><img src="http://farm3.static.flickr.com/2711/4389554227_f36eafa67f_o.jpg" alt="" /></p>

<p>至于驾车人士关心的如何制止行人乱穿马路，那就是不是我考虑的问题了。我自己是遵守交通规则的，有斑马线就走斑马线，有行人交通灯就等绿灯才过。</p>

<p>欢迎驾车人士批判，哈哈</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2010/02/27/Portable-pedestrians-cross-the-street-warning-great/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/02/26/Two-questions-about-SIP-message-transport/">Two Questions About SIP Message Transport</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-02-26T12:30:00+08:00" pubdate data-updated="true">2010-02-26</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/sip/'>SIP</a>, <a class='tag' href='/blog/tags/softwaredev/'>SoftwareDev</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><h3 id="sip-messages-are-sent-in-mix-of-udp-and-tcp">SIP messages are sent in mix of UDP and TCP</h3>

<p>In our test we found that our client first sent SIP messages in UDP but later on it changed to TCP. Is it an issue?</p>

<p>In RFC 3261 (SIP) chapter 18.1.1 and 18.2.1, it says:</p>

<blockquote>
  <p>If a request is within 200 bytes of the path MTU, or if it is larger than 1300 bytes and the path MTU is unknown, the request MUST be sent using an RFC 2914 congestion controlled transport protocol, such as TCP. … This prevents fragmentation of messages over UDP and provides congestion control for larger messages.</p>

  <p>For any port and interface that a server listens on for UDP, it MUST listen on that same port and interface for TCP. This is because a message may need to be sent using TCP, rather than UDP, if it is too large.</p>
</blockquote>

<p>So, whether send a SIP message in UDP or TCP is decided bytransport layer. When the initial SIP message of a transaction is sent in UDP it’s possible that the consequent messages are sent in TCP.</p>

<h3 id="sip-message-is-resent-in-05-second">SIP MESSAGE is resent in 0.5 second</h3>

<p>In another test case we found that the client resends the SIP MESSAGE request in 0.5 second if it doesn’t receive the response. We know that SIP message should be resent in a specific time if no response is received. But why the interval is 0.5 second? Is it configurable in Sailfin?</p>

<p>Also go to RFC 3261, find the answer in chapter 17.1.1.2 and 17.1.2.2:</p>

<blockquote>
  <p>If an unreliable transport is in use, the client transaction MUST set timer E to fire in T1 seconds. If timer E fires while still in this state, the timer is reset, but this time with a value of MIN(2<em>T1, T2). When the timer fires again, it is reset to a MIN(4</em>T1, T2). … For the default values of T1 and T2, this results in intervals of 500 ms, 1 s, 2 s, 4 s, 4 s, 4 s, etc.</p>

  <p>The default value for T1 is 500 ms. T1 is an estimate of the RTT between the client and server transactions. … T1 MAY be chosen larger, and this is RECOMMENDED if it is known in advance (such as on high latency access links) that the RTT is larger.</p>
</blockquote>

<p>In SailFin(GlassFish) the value of T1 and T2 can be configured in admin console under: Configuration - SIP Service - SIP Protocol.</p>
</div>
  
  
  
    <footer>
        <a href="/blog/2010/02/26/Two-questions-about-SIP-message-transport/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/02/24/Illustration-Spring-ApplicationContext-in-enterprise-application/">图解：Spring ApplicationContext in Enterprise Application</a></h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2010-02-24T21:46:00+08:00" pubdate data-updated="true">2010-02-24</time>
        
         | 

<span class="tags">
  
    <a class='tag' href='/blog/tags/softwaredev/'>SoftwareDev</a>, <a class='tag' href='/blog/tags/spring/'>Spring</a>
  
</span>


        
      </p>
    
  </header>


  <div class="entry-content"><p>在一个比较复杂的enterprise application (EAR)里面，往往有多个war和ejb，如果希望使用Springframework通过IoC方式来管理及装配POJO beans，就要面对如何初始化application context，由谁来初始化，如何让这些war和ejb共享application context等问题。</p>

<p>关于多个war、ejb共享application context的方法，在下面这两篇文章里解释得比较清楚：</p>

<ul>
  <li><a href="http://blog.springsource.com/2007/06/11/using-a-shared-parent-application-context-in-a-multi-war-spring-application/">Using a shared parent application context in a multi-war Spring application</a></li>
  <li><a href="http://springtips.blogspot.com/2007/09/using-shared-context-from-ejbs.html">Using a Shared Context from EJBs</a></li>
</ul>

<p>在这里，我不再详细叙述上面文章中的内容，通过图解的方式希望能让它更易理解，需要对照阅读。</p>

<p>图中的方块、圆圈都表示实例，形状的嵌套表示它们的包含关系。在例子里，缺省值都显式写出来，方便查找。</p>

<p><a href="http://www.flickr.com/photos/leoliang/4384915548/"><img src="http://farm5.static.flickr.com/4037/4384915548_2ec7d610e6_o.png" alt="share-context-1" /></a></p>

<p>先看图中靛蓝色的box，是ContextSingletonBeanFactoryLocator实例，application context的共享是依靠它来实现的：对于每个locatorFactorSelector，在一个classloader的范围内只会存在一个ContextSingletonBeanFactoryLocator的实例。ContextSingletonBeanFactoryLocator内部有一个ApplicationContext（图中的天蓝色box），它的bean是由locatorFactorSelector所指向的xml文件所定义的。例如locatorFactorSelector为classpath*:beanRefContext.xml，就会寻找classpath中所有的beanRefContext.xml文件并根据它们去创建内部ApplicationContext。这个内部ApplicationContext只是其它ApplicationContext的容器，不存放application的bean。一个beanRefContext.xml文件应该像下面那样，里面是一个ApplicationContext，它才是真正的业务bean的容器。如果需要可以设置它的parent context。如果有多个beanRefContext.xml文件，就会创建多个ApplicationContext，它们通过id来标识。</p>

<pre><code>&lt;beans&gt;
    &lt;bean id="a" class="org.springframework.context.support.ClassPathXmlApplicationContext"&gt;
        &lt;constructor-arg&gt;
            &lt;list&gt;
                &lt;value&gt;context_a.xml&lt;/value&gt;
            &lt;/list&gt;
        &lt;/constructor-arg&gt;
        &lt;constructor-arg&gt;
            &lt;ref bean="b" /&gt;
        &lt;/constructor-arg&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>

<p>EJB应该在onCreate()过程中通过下面的代码来获得application context，需要通过factoryKey（例子里是”a”）来指定具体是哪个context：</p>

<pre><code>beanFactory= ContextSingletonBeanFactoryLocator.getInstance("classpath*:beanRefContext.xml").useBeanFactory("a").getFactory();
</code></pre>

<p>在war里是依靠ContextLoaderListener来启动ApplicationContext的。在web.xml里加入：</p>

<pre><code>    &lt;listener&gt;
        &lt;listener-class&gt;
            org.springframework.web.context.ContextLoaderListener
        &lt;/listener-class&gt;
    &lt;/listener&gt;
</code></pre>

<p>这个application context包含的是/WEB-INF/applicationContext.xml中定义的beans。在Servlet中通过下面的代码可以获得这个context：</p>

<pre><code>beanFactory = WebApplicationContextUtils.getWebApplicationContext(this.getServletContext());
</code></pre>

<p>但这样创建出来的是一个独立的application context，仅仅在war内部可以访问，无法做到多个war和ejb之间共享。</p>

<p>要实现共享，就要在web.xml中再加入：</p>

<pre><code>    &lt;context-param&gt;
        &lt;param-name&gt;parentContextKey&lt;/param-name&gt;
        &lt;param-value&gt;b&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;locatorFactorySelector&lt;/param-name&gt;
        &lt;param-value&gt;classpath*:beanRefContext.xml&lt;/param-value&gt; &lt;!-- this is the default value --&gt;
    &lt;/context-param&gt;
</code></pre>

<p>这样，当ContextLoaderListener创建war的application context时，会根据locatorFactorySelector去取相应的ContextSingletonBeanFactoryLocator实例，并且从locator中根据parentContextKey拿到具体的context，将这个context作为war的application context的parent。在图中，war 1的servlet可以访问到key为’b’的context，因为它是当前context的parent。</p>

<p>最后的效果就是：哪个war或者ejb先初始化，它就会去初始化ContextSingletonBeanFactoryLocator实例，由于是singleton，只会有一个实例存在，所有的war和ejb都从这个locator里面拿到具体存放业务bean的context，实现了context的共享。</p>

<p>在这里需要留意的是classloader，必须很清楚的知道哪些类是由哪个层次的classloader加载的：所有共享的bean，以及相关的spring jar都必须由EJB classloader加载。关于EAR的classloader及层次关系请参看 <a href="http://good-good-study.appspot.com/blog/posts/4218">WebLogic的classloading</a>。</p>

<p>在实际应用中，往往不需要对application context作隔离，整个ear里面所有ejb、war共享一个application context是最简便的。这时war里不需要定义任何context和context loader，与EJB一样直接使用ContextSingletonBeanFactoryLocator就可以获取到context。</p>

<pre><code>beanFactory= ContextSingletonBeanFactoryLocator.getInstance("classpath*:beanRefContext.xml").useBeanFactory("share-context").getFactory();
</code></pre>

<p><a href="http://www.flickr.com/photos/leoliang/5370082919/"><img src="http://farm6.static.flickr.com/5245/5370082919_6dfc7f7b1d_z.jpg" alt="sping_shared_context" /></a></p>
</div>
  
  
  
    <footer>
        <a href="/blog/2010/02/24/Illustration-Spring-ApplicationContext-in-enterprise-application/#disqus_thread">Comments</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/blog/page/6/">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/blog/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/06/24/try-octopress-markdown-features/">试验 Octopress 的各种特性</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/09/Some-reading-record/">一些读书记录</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/05/The-programmer-thought-of-uniting-the-reading-notes/">《程序员的思维修炼》读书笔记</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/10/By-mobile-phone-remote-control-Linux-backstage-radio-broadcast-requirements/">用手机遥控Linux后台播放豆瓣电台</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/25/In-the-amazon-bought-the-computer-motherboard-and-summarizes-the-experience-of-fault-return/">在亚马逊买电脑主板，故障退货的经历及总结</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
<a style="font-size: 134%" href="/blog/tags/android/">Android</a>
<a style="font-size: 108%" href="/blog/tags/anti-gfw/">Anti-GFW</a>
<a style="font-size: 70%" href="/blog/tags/appserver/">AppServer</a>
<a style="font-size: 70%" href="/blog/tags/blogging/">Blogging</a>
<a style="font-size: 70%" href="/blog/tags/build/">Build</a>
<a style="font-size: 70%" href="/blog/tags/diy/">DIY</a>
<a style="font-size: 104%" href="/blog/tags/diy/">Diy</a>
<a style="font-size: 70%" href="/blog/tags/excel/">Excel</a>
<a style="font-size: 93%" href="/blog/tags/funny/">Funny</a>
<a style="font-size: 85%" href="/blog/tags/gps/">GPS</a>
<a style="font-size: 139%" href="/blog/tags/gps-gis/">GPS_GIS</a>
<a style="font-size: 70%" href="/blog/tags/geocaching/">Geocaching</a>
<a style="font-size: 70%" href="/blog/tags/http/">HTTP</a>
<a style="font-size: 144%" href="/blog/tags/idea/">Idea</a>
<a style="font-size: 99%" href="/blog/tags/imageprocessing/">ImageProcessing</a>
<a style="font-size: 70%" href="/blog/tags/learning/">Learning</a>
<a style="font-size: 108%" href="/blog/tags/life/">Life</a>
<a style="font-size: 85%" href="/blog/tags/maven/">Maven</a>
<a style="font-size: 146%" href="/blog/tags/misc/">Misc</a>
<a style="font-size: 85%" href="/blog/tags/novel/">Novel</a>
<a style="font-size: 70%" href="/blog/tags/outdoor/">Outdoor</a>
<a style="font-size: 85%" href="/blog/tags/personaldevelopment/">PersonalDevelopment</a>
<a style="font-size: 93%" href="/blog/tags/reading/">Reading</a>
<a style="font-size: 93%" href="/blog/tags/running/">Running</a>
<a style="font-size: 70%" href="/blog/tags/sip/">SIP</a>
<a style="font-size: 142%" href="/blog/tags/software/">Software</a>
<a style="font-size: 160%" href="/blog/tags/softwaredev/">SoftwareDev</a>
<a style="font-size: 99%" href="/blog/tags/sports/">Sports</a>
<a style="font-size: 85%" href="/blog/tags/spring/">Spring</a>
<a style="font-size: 119%" href="/blog/tags/sys-admin/">Sys_Admin</a>
<a style="font-size: 104%" href="/blog/tags/timemanagement/">TimeManagement</a>
<a style="font-size: 85%" href="/blog/tags/weblogic/">WebLogic</a>
<a style="font-size: 70%" href="/blog/tags/backup/">backup</a>
<a style="font-size: 93%" href="/blog/tags/idea/">idea</a>
<a style="font-size: 104%" href="/blog/tags/mobile/">mobile</a>
<a style="font-size: 70%" href="/blog/tags/wallpaper/">wallpaper</a>
<a style="font-size: 70%" href="/blog/tags/书摘/">书摘</a>
<a style="font-size: 70%" href="/blog/tags/交通/">交通</a>
<a style="font-size: 70%" href="/blog/tags/公民与社会/">公民与社会</a>
<a style="font-size: 70%" href="/blog/tags/家电/">家电</a>
<a style="font-size: 70%" href="/blog/tags/建筑/">建筑</a>
<a style="font-size: 70%" href="/blog/tags/文化艺术/">文化艺术</a>
<a style="font-size: 70%" href="/blog/tags/概率/">概率</a>
<a style="font-size: 70%" href="/blog/tags/环保/">环保</a>
<a style="font-size: 70%" href="/blog/tags/统计/">统计</a>
<a style="font-size: 70%" href="/blog/tags/阅读/">阅读</a>

  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Leo Liang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'aleung';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
